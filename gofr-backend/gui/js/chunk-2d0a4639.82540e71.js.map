{"version":3,"sources":["webpack:///./src/components/gofr/gofr-search.vue?a7f8","webpack:///src/components/gofr/gofr-search.vue","webpack:///./src/components/gofr/gofr-search.vue?6eb1","webpack:///./src/components/gofr/gofr-search.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","label","_t","error_message","_e","staticStyle","attrs","headers","results","options","total","loading","on","$event","clickIt","staticRenderFns","name","props","data","debug","prevPage","link","update_again","watch","terms","handler","getData","deep","created","mounted","methods","$store","state","searchAction","requestResourceUpdateData","requestAction","requestUpdatingResource","$router","push","path","checkRerun","rerun","restart","page","url","find","replace","substring","indexOf","sort","sortDesc","idx","sortBy","term","join","console","log","err","component","VCard","VCardSubtitle","VCardText","VCardTitle","VContainer","VDataTable","VSpacer"],"mappings":"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","file":"js/chunk-2d0a4639.82540e71.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-container',{staticClass:\"py-5\"},[_c('v-card',[_c('v-card-title',[_vm._v(\" Search \"+_vm._s(_vm.label)+\" \"),_c('v-spacer')],1),_c('v-card-title',[_vm._t(\"default\")],2),(_vm.error_message)?_c('v-card-subtitle',{staticClass:\"white--text error\"},[_vm._v(_vm._s(_vm.error_message))]):_vm._e(),_c('v-card-text',[_c('v-container'),_c('v-data-table',{staticClass:\"elevation-1\",staticStyle:{\"cursor\":\"pointer\"},attrs:{\"headers\":_vm.headers,\"items\":_vm.results,\"item-key\":\"id\",\"options\":_vm.options,\"server-items-length\":_vm.total,\"footer-props\":{ 'items-per-page-options': [5,10,20,50] },\"loading\":_vm.loading},on:{\"update:options\":function($event){_vm.options=$event},\"click:row\":_vm.clickIt}})],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <v-container class=\"py-5\">\n    <v-card>\n      <v-card-title>\n        Search {{ label }}\n        <v-spacer></v-spacer>\n        <!-- <v-btn :class=\"addLink ? addLink.class || 'primary' : 'primary'\" :to=\"addLink ? addLink.url : '/resource/add/'+page\">\n          <v-icon v-if=\"addLink && addLink.icon\">{{ addLink.icon }}</v-icon>\n          <v-icon v-else>mdi-database-plus</v-icon>\n          Add {{label}}\n        </v-btn> -->\n      </v-card-title>\n      <v-card-title>\n        <slot></slot>\n      </v-card-title>\n      <v-card-subtitle\n        v-if=\"error_message\"\n        class=\"white--text error\"\n      >{{ error_message }}</v-card-subtitle>\n      <v-card-text>\n        <v-container>\n        </v-container>\n        <v-data-table\n          style=\"cursor: pointer\"\n          :headers=\"headers\"\n          :items=\"results\"\n          item-key=\"id\"\n          :options.sync=\"options\"\n          :server-items-length=\"total\"\n          :footer-props=\"{ 'items-per-page-options': [5,10,20,50] }\"\n          :loading=\"loading\"\n          class=\"elevation-1\"\n          @click:row=\"clickIt\"\n        ></v-data-table>\n      </v-card-text>\n    </v-card>\n\n  </v-container>\n</template>\n\n<script>\nimport axios from 'axios';\nexport default {\n  name: \"gofr-search\",\n  props: [\"profile\", \"request-updating-resource\", \"request-action\", \"search-action\", \"fields\", \"label\", \"terms\", \"page\", \"resource\", \"add-link\"],\n  data: function() {\n    return {\n      debug: \"\",\n      headers: [],\n      results: [],\n      options: { itemsPerPage: 10 },\n      loading: false,\n      total: 0,\n      prevPage: -1,\n      link: [],\n      error_message: null,\n      update_again: { rerun: false, restart: false }\n    };\n  },\n  watch: {\n    terms: {\n      handler() {\n        this.getData(true);\n      },\n      deep: true\n    },\n    options: {\n      handler() {\n        this.getData();\n      },\n      deep: true\n    }\n  },\n  created: function() {\n    for (let field of this.fields) {\n      this.headers.push({ text: field[0], value: field[1] });\n    }\n  },\n  mounted: function() {\n    this.getData(true);\n  },\n  methods: {\n    clickIt: function(record) {\n      this.$store.state.searchAction = this.searchAction\n      this.$store.state.requestResourceUpdateData.requestAction = this.requestAction\n      this.$store.state.requestResourceUpdateData.requestUpdatingResource = this.requestUpdatingResource\n      this.$router.push({\n        path: `/Resource/View/${this.page}/${record.id}`\n      });\n    },\n    checkRerun() {\n      if ( !this.loading && this.update_again.rerun ) {\n        this.getData( this.update_again.restart )\n        this.update_again = { rerun: false, restart: false }\n      }\n    },\n    getData(restart) {\n      if ( this.loading ) {\n        this.update_again.rerun = true\n        this.update_again.restart = this.update_again.restart || restart\n        return\n      }\n      this.loading = true;\n      this.error_message = null;\n      let url = \"\";\n      if (restart) this.options.page = 1;\n      if (this.options.page > 1) {\n        if (this.options.page === this.prevPage - 1) {\n          url = this.link.find(link => link.relation === \"previous\").url;\n        } else if (this.options.page === this.prevPage + 1) {\n          url = this.link.find(link => link.relation === \"next\").url;\n        }\n        // Should make this smarter to keep the _getpages parameter,\n        // but the issue is with tracking permissions on the resource\n        url = url.replace(/_getpages=[^&]*&*/, \"\").replace(\"/fhir/\"+this.$store.state.config.userConfig.FRDatasource+\"?\",\"/fhir/\"+this.$store.state.config.userConfig.FRDatasource+\"/\"+this.resource+\"?\")\n        url = url.substring(url.indexOf(\"/fhir/\"));\n\n        //some of the hapi instances requires _total=accurate to always be available for them to return total resources\n        if(url.indexOf('_total=accurate') === -1) {\n          url = url + '&_total=accurate'\n        }\n      }\n      if (url === \"\") {\n        let count = this.options.itemsPerPage || 10;\n        let sort = \"\";\n        for (let idx in this.options.sortBy) {\n          if (sort) {\n            sort += \",\";\n          }\n          if (this.options.sortDesc[idx]) {\n            sort += \"-\";\n          }\n          sort += this.options.sortBy[idx];\n        }\n        url =\n          \"/fhir/\" +\n          this.$store.state.config.userConfig.FRDatasource + \"/\" +\n          this.resource +\n          \"?_count=\" +\n          count +\n          \"&_total=accurate&_profile=\" +\n          this.profile;\n        let sTerms = Object.keys(this.terms);\n        for (let term of sTerms) {\n          if ( Array.isArray( this.terms[term] ) ) {\n            if ( this.terms[term].length > 0 ) {\n              url += \"&\" + term + \"=\" + this.terms[term].join(',')\n            }\n          } else if ( this.terms[term] ) {\n            url += \"&\" + term + \"=\" + this.terms[term];\n          }\n        }\n        this.debug = url;\n      }\n      this.prevPage = this.options.page;\n      axios.get(url).then(async (response) => {\n        let data = response.data\n        this.results = [];\n        if (data.total > 0) {\n          this.link = data.link;\n          for (let entry of data.entry) {\n            let result = { id: entry.resource.id };\n            for (let field of this.fields) {\n              let fieldDisplay = this.$fhirpath.evaluate( entry.resource, field[1] );\n              result[field[1]] = await this.$fhirutils.lookup( fieldDisplay[0], field[2] )\n            }\n            this.results.push(result);\n          }\n        }\n        this.total = data.total;\n        this.loading = false;\n        this.checkRerun()\n      }).catch(err => {\n        this.loading = false;\n        this.error_message = \"Unable to load results.\";\n        this.checkRerun()\n        console.log(err);\n      });\n    }\n  }\n};\n</script>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./gofr-search.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./gofr-search.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./gofr-search.vue?vue&type=template&id=f50695e4&\"\nimport script from \"./gofr-search.vue?vue&type=script&lang=js&\"\nexport * from \"./gofr-search.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardSubtitle } from 'vuetify/lib/components/VCard';\nimport { VCardText } from 'vuetify/lib/components/VCard';\nimport { VCardTitle } from 'vuetify/lib/components/VCard';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VDataTable } from 'vuetify/lib/components/VDataTable';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VCard,VCardSubtitle,VCardText,VCardTitle,VContainer,VDataTable,VSpacer})\n"],"sourceRoot":""}