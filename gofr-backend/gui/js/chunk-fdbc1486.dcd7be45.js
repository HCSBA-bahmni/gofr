(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fdbc1486"],{"99fa":function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ihris-element",{attrs:{edit:e.edit,loading:e.loading},scopedSlots:e._u([{key:"form",fn:function(){return["tree"==e.displayType?r("v-menu",{ref:"menu",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"290px","max-height":"500px"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[r("v-text-field",e._g({attrs:{label:e.display,readonly:"",outlined:"","hide-details":"auto",rules:e.rules,"error-messages":e.errors,loading:e.loading,dense:""},scopedSlots:e._u([{key:"label",fn:function(){return[e._v(e._s(e.display)+" "),e.required?r("span",{staticClass:"red--text font-weight-bold"},[e._v("*")]):e._e()]},proxy:!0}],null,!0),model:{value:e.displayValue,callback:function(t){e.displayValue=t},expression:"displayValue"}},i))]}}],null,!1,4240353417),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[e.disabled||e.preset&&"ResourceAdd"===e.$route.name?e._e():r("v-card",[r("v-treeview",{attrs:{active:e.active,items:e.items,"load-children":e.fetchChildren,open:e.open,"item-disabled":"locked",activatable:"","multiple-active":!1,"selection-type":"independent",loading:e.loading},on:{"update:active":function(t){e.active=t},"update:open":function(t){e.open=t}}})],1)],1):r("v-autocomplete",{attrs:{loading:e.loading,items:e.items,"search-input":e.search,"cache-items":"",flat:"","hide-no-data":"","hide-details":"",label:e.display,outlined:"",dense:"",placeholder:"Start typing for selection",rules:e.rules,disabled:e.disabled||e.preset&&"resource_add"===e.$route.name,"error-messages":e.errors},on:{"update:searchInput":function(t){e.search=t},"update:search-input":function(t){e.search=t},change:function(t){e.errors=[]}},scopedSlots:e._u([{key:"label",fn:function(){return[e._v(e._s(e.display)+" "),e.required?r("span",{staticClass:"red--text font-weight-bold"},[e._v("*")]):e._e()]},proxy:!0}]),model:{value:e.select,callback:function(t){e.select=t},expression:"select"}})]},proxy:!0},{key:"header",fn:function(){return[e._v(" "+e._s(e.display)+" ")]},proxy:!0},{key:"value",fn:function(){return[e._v(" "+e._s(e.displayValue)+" ")]},proxy:!0}])})},s=[],a=r("b85c"),n=r("1da1"),o=(r("96cf"),r("ac1f"),r("841c"),r("5319"),r("d3b7"),r("caad"),r("2532"),r("b0c0"),r("9911"),r("7db0"),r("8a79"),r("bc3a")),l=r.n(o),c=r("b287"),u=r("b383"),d="http://hl7.org/fhir/StructureDefinition/",h={name:"fhir-reference",props:["field","label","sliceName","targetProfile","targetResource","min","max","base-min","base-max","slotProps","path","sub-fields","edit","readOnlyIfSet","constraints","displayType","initialValue","overrideValue"],components:{IhrisElement:c["a"]},data:function(){return{source:{path:"",data:{}},value:{reference:""},qField:"valueReference",loading:!1,search:"",menu:!1,items:[],select:"",resource:"",awaitingSearch:!1,displayValue:"",preset:!1,disabled:!1,errors:[],lockWatch:!1,active:[],open:[],treeLookup:{},allAllowed:!0}},created:function(){this.setupData()},watch:{slotProps:{handler:function(){this.lockWatch||this.setupData()},deep:!0},search:function(e){var t=this;this.awaitingSearch||setTimeout((function(){e&&e.length>1&&t.querySelections(t.search),t.awaitingSearch=!1}),500),this.awaitingSearch=!0},select:function(e){this.value.reference=e,this.getDisplay()},active:function(){this.active.length?(this.select=this.active[0],this.displayValue=this.treeLookup[this.select]):(this.select=void 0,this.displayValue=""),this.menu=!1}},methods:{setupData:function(){if(this.targetProfile&&this.targetResource&&(this.targetProfile.replace(d,"")===this.targetResource?this.allAllowed=!0:this.allAllowed=!1,this.resource=this.targetResource),"tree"===this.displayType&&this.setupTreeItems(),this.slotProps&&this.slotProps.source){if(this.source={path:this.slotProps.source.path+"."+this.field,data:{}},this.slotProps.source.fromArray)this.source.data=this.slotProps.source.data;else{var e=this.$fhirutils.pathFieldExpression(this.field),t=this.$fhirpath.evaluate(this.slotProps.source.data,e);this.source.data=t[0]}this.source.data&&(this.preset=!0,this.select=this.source.data.reference,this.lockWatch=!0)}this.disabled=this.readOnlyIfSet&&this.preset},setupTreeItems:function(){var e=this.initialValue;this.overrideValue&&(e=this.overrideValue),this.loading=!0;var t={};t=e?{partof:e}:{"partof:missing":!0},t._count=500;var r="/fhir/"+this.$store.state.config.userConfig.FRDatasource+"/"+this.resource+"?"+u.stringify(t);this.items=[],this.addItems(r,this.items)},checkChildren:function(e){var t={partof:e.id,_summary:"count"},r="/fhir/"+this.$store.state.config.userConfig.FRDatasource+"/"+this.resource+"?"+u.stringify(t);return new Promise((function(t){l.a.get(r).then((function(r){var i=r.data;i.total&&i.total>0&&(e.children=[]),t()})).catch((function(e){console.log("failed to check children for",r,e),t()}))}))},addItems:function(e,t){var r=this;l.a.get(e).then(function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(i){var s,n,o,l,c,u,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s=i.data,!(s.entry&&s.entry.length>0)){e.next=23;break}n=Object(a["a"])(s.entry),e.prev=3,n.s();case 5:if((o=n.n()).done){e.next=15;break}return l=o.value,c=!r.allAllowed&&!l.resource.meta.profile.includes(r.targetProfile),u={id:l.resource.resourceType+"/"+l.resource.id,name:l.resource.name,locked:c},e.next=11,r.checkChildren(u);case 11:r.treeLookup[u.id]=u.name,t.push(u);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](3),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:s.link?(d=s.link.find((function(e){return"next"===e.relation})),d?r.addItems(d.url,t):r.loading=!1):r.loading=!1;case 24:case"end":return e.stop()}}),e,null,[[3,17,20,23]])})));return function(t){return e.apply(this,arguments)}}()).catch((function(t){console.log("Failed to add items for",e,t),r.loading=!1}))},fetchChildren:function(e){var t=this,r={};r={partof:e.id,_count:500};var i="/fhir/"+this.$store.state.config.userConfig.FRDatasource+"/"+this.resource+"?"+u.stringify(r);return this.loading=!0,this.addItems(i,e.children),new Promise((function(e){var r=0,i=function i(){!t.loading||r++>100?e():setTimeout(i,200)};i()}))},querySelections:function(e){var t=this;this.loading=!0;var r={"name:contains":e};this.targetProfile.endsWith(this.resource)||(r._profile=this.targetProfile);var i="/fhir/"+this.$store.state.config.userConfig.FRDatasource+"/"+this.resource+"?"+u.stringify(r);l.a.get(i).then(function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(r){var i,s,n,o,l,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=r.data,t.items=[],!i.entry||!i.entry.length){e.next=24;break}s=Object(a["a"])(i.entry),e.prev=4,s.s();case 6:if((n=s.n()).done){e.next=16;break}return o=n.value,l=o.resource.resourceType+"/"+o.resource.id,c={value:l},e.next=12,t.$fhirutils.resourceLookup(l);case 12:c.text=e.sent,t.items.push(c);case 14:e.next=6;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](4),s.e(e.t0);case 21:return e.prev=21,s.f(),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[4,18,21,24]])})));return function(t){return e.apply(this,arguments)}}())},getDisplay:function(){var e=this;(!this.edit||this.preset)&&this.value&&this.value.reference&&(this.loading=!0,this.$fhirutils.resourceLookup(this.value.reference).then((function(t){e.displayValue=t,"tree"!==e.displayType&&e.items.push({text:t,value:e.value.reference}),e.loading=!1})))}},computed:{index:function(){return this.slotProps?this.slotProps.input:void 0},display:function(){return this.slotProps&&this.slotProps.input?this.slotProps.input.label:this.label},required:function(){return(this.index||0)<this.min},rules:function(){var e=this;return this.required?[function(t){return!!t||e.display+" is required"}]:[]}}},f=h,p=r("2877"),v=r("6544"),m=r.n(v),g=r("c6a6"),y=r("b0af"),b=r("e449"),k=r("8654"),x=r("eb2a"),w=Object(p["a"])(f,i,s,!1,null,null,null);t["default"]=w.exports;m()(w,{VAutocomplete:g["a"],VCard:y["a"],VMenu:b["a"],VTextField:k["a"],VTreeview:x["a"]})},b287:function(e,t,r){"use strict";var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[e.edit?r("v-container",[e._t("form")],2):r("div",[r("v-row",{attrs:{dense:""}},[r("v-col",{staticClass:"font-weight-bold",attrs:{cols:e.$store.state.cols.header}},[e._t("header")],2),e.loading?r("v-col",{attrs:{cols:e.$store.state.cols.content}},[r("v-progress-linear",{attrs:{indeterminate:"",color:"primary"}})],1):r("v-col",{attrs:{cols:e.$store.state.cols.content}},[e._t("value")],2)],1),r("v-divider")],1)],1)},s=[],a={name:"ihris-element",props:["edit","loading"]},n=a,o=r("2877"),l=r("6544"),c=r.n(l),u=r("62ad"),d=r("a523"),h=r("ce7e"),f=r("8e36"),p=r("0fd9"),v=Object(o["a"])(n,i,s,!1,null,null,null);t["a"]=v.exports;c()(v,{VCol:u["a"],VContainer:d["a"],VDivider:h["a"],VProgressLinear:f["a"],VRow:p["a"]})}}]);
//# sourceMappingURL=chunk-fdbc1486.dcd7be45.js.map