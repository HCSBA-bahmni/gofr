{"remainingRequest":"/home/ally/gofr/facility-recon-gui/node_modules/babel-loader/lib/index.js!/home/ally/gofr/facility-recon-gui/node_modules/eslint-loader/index.js??ref--13-0!/home/ally/gofr/facility-recon-gui/src/plugins/fhirutils.js","dependencies":[{"path":"/home/ally/gofr/facility-recon-gui/src/plugins/fhirutils.js","mtime":1619351477615},{"path":"/home/ally/gofr/facility-recon-gui/node_modules/cache-loader/dist/cjs.js","mtime":1619257191457},{"path":"/home/ally/gofr/facility-recon-gui/node_modules/babel-loader/lib/index.js","mtime":1619257191453},{"path":"/home/ally/gofr/facility-recon-gui/node_modules/eslint-loader/index.js","mtime":1619257191105}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9ob21lL2FsbHkvZ29mci9mYWNpbGl0eS1yZWNvbi1ndWkvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnN0YXJ0cy13aXRoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwoKdmFyIGZoaXJwYXRoID0gcmVxdWlyZSgnZmhpcnBhdGgnKTsKCnZhciBheGlvcyA9IHJlcXVpcmUoJ2F4aW9zJyk7Cgp2YXIgZmhpcnV0aWxzID0gewogIF9jb2RlX2NhY2hlOiB7fSwKICBfY29kZV9sb2FkaW5nOiB7fSwKICBfc2V0Q2FjaGU6IGZ1bmN0aW9uIF9zZXRDYWNoZShsb29rdXAsIHZhbHVlKSB7CiAgICBmaGlydXRpbHMuX2NvZGVfY2FjaGVbbG9va3VwXSA9IHZhbHVlOwogICAgZmhpcnV0aWxzLl9jb2RlX2xvYWRpbmdbbG9va3VwXSA9IGZhbHNlOwogICAgcmV0dXJuIHZhbHVlOwogIH0sCiAgY2hlY2tDb25zdHJhaW50czogZnVuY3Rpb24gY2hlY2tDb25zdHJhaW50cyhjb25zdHJhaW50TGlzdCwgY29uc3RyYWludERldGFpbHMsIGVsZW1lbnQsIGVycm9ycywgZmhpcklkKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICB2YXIgY29uc3RyYWludHMgPSBjb25zdHJhaW50TGlzdC5zcGxpdCgiLCIpOwogICAgICB2YXIgcHJvbWlzZXMgPSBbXTsKCiAgICAgIHZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihjb25zdHJhaW50cyksCiAgICAgICAgICBfc3RlcDsKCiAgICAgIHRyeSB7CiAgICAgICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoKSB7CiAgICAgICAgICB2YXIgY29uc3RyYWludCA9IF9zdGVwLnZhbHVlOwoKICAgICAgICAgIGlmIChjb25zdHJhaW50RGV0YWlsc1tjb25zdHJhaW50XSkgewogICAgICAgICAgICB2YXIgcmVzdWx0cyA9IGZoaXJwYXRoLmV2YWx1YXRlKGVsZW1lbnQsIGNvbnN0cmFpbnREZXRhaWxzW2NvbnN0cmFpbnRdLmV4cHJlc3Npb24pOwoKICAgICAgICAgICAgaWYgKGNvbnN0cmFpbnQuc3RhcnRzV2l0aCgnaWhyaXMtc2VhcmNoJykpIHsKICAgICAgICAgICAgICB2YXIgcmVzb3VyY2UgPSByZXN1bHRzLnNoaWZ0KCk7CiAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gWyJfZWxlbWVudHM9aWQiXTsKCiAgICAgICAgICAgICAgd2hpbGUgKHJlc3VsdHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBxdWVyeS5wdXNoKHJlc3VsdHMuc2hpZnQoKSArICI9IiArIGVuY29kZVVSSShyZXN1bHRzLnNoaWZ0KCkpKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHByb21pc2VzLnB1c2gobmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgICAgYXhpb3MuZ2V0KCIvZmhpci8iICsgcmVzb3VyY2UgKyAiPyIgKyBxdWVyeS5qb2luKCImIikpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBidW5kbGUgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICAgICAgICAgICAgaWYgKGJ1bmRsZS50b3RhbCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZmhpcklkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGlkcyA9IGZoaXJwYXRoLmV2YWx1YXRlKGJ1bmRsZS5lbnRyeSwgInJlc291cmNlLmlkIik7CgogICAgICAgICAgICAgICAgICAgIGlmIChpZHMuaW5jbHVkZXMoZmhpcklkKSkgewogICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgcmVjb3JkIHRoYXQgbWF0Y2hlZAogICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goY29uc3RyYWludERldGFpbHNbY29uc3RyYWludF0uaHVtYW4pOwogICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKGNvbnN0cmFpbnREZXRhaWxzW2NvbnN0cmFpbnRdLmh1bWFuKTsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfSBlbHNlIGlmICghcmVzdWx0cy5ldmVyeShCb29sZWFuKSkgewogICAgICAgICAgICAgIGVycm9ycy5wdXNoKGNvbnN0cmFpbnREZXRhaWxzW2NvbnN0cmFpbnRdLmh1bWFuKTsKICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKGZhbHNlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHsKICAgICAgICAgIF9sb29wKCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvci5mKCk7CiAgICAgIH0KCiAgICAgIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKGZ1bmN0aW9uIChyZXN1bHRzKSB7CiAgICAgICAgaWYgKHJlc3VsdHMuZXZlcnkoQm9vbGVhbikpIHsKICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlc29sdmUoZmFsc2UpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgIHJlamVjdChlcnIpOwogICAgICB9KTsKICAgIH0pOwogIH0sCiAgbG9va3VwOiBmdW5jdGlvbiBsb29rdXAoZGlzcGxheSwgZGVmYXVsdFN5c3RlbSkgewogICAgaWYgKCFkaXNwbGF5KSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIHJldHVybiByZXNvbHZlKGRpc3BsYXkpOwogICAgICB9KTsKICAgIH0KCiAgICBpZiAoZGVmYXVsdFN5c3RlbSkgewogICAgICByZXR1cm4gZmhpcnV0aWxzLmNvZGVMb29rdXAoZGVmYXVsdFN5c3RlbSwgZGlzcGxheSk7CiAgICB9IGVsc2UgaWYgKGRpc3BsYXkuc3lzdGVtICYmIGRpc3BsYXkuY29kZSkgewogICAgICByZXR1cm4gZmhpcnV0aWxzLmNvZGVMb29rdXAoZGlzcGxheS5zeXN0ZW0sIGRpc3BsYXkuY29kZSk7CiAgICB9IGVsc2UgaWYgKGRpc3BsYXkucmVmZXJlbmNlKSB7CiAgICAgIHJldHVybiBmaGlydXRpbHMucmVzb3VyY2VMb29rdXAoZGlzcGxheS5yZWZlcmVuY2UpOwogICAgfSBlbHNlIGlmICgvKFtBLVpdXHcqKVwvKFtBLVphLXowLTlcLS5dezEsNjR9KS8udGVzdChkaXNwbGF5KSkgewogICAgICByZXR1cm4gZmhpcnV0aWxzLnJlc291cmNlTG9va3VwKGRpc3BsYXkpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgcmV0dXJuIHJlc29sdmUoZGlzcGxheSk7CiAgICAgIH0pOwogICAgfQogIH0sCiAgcmVzb3VyY2VMb29rdXA6IGZ1bmN0aW9uIHJlc291cmNlTG9va3VwKHJlZmVyZW5jZSkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgIHZhciBsb29rdXAgPSByZWZlcmVuY2U7CgogICAgICBpZiAoZmhpcnV0aWxzLl9jb2RlX2xvYWRpbmdbbG9va3VwXSkgewogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmVzb2x2ZShmaGlydXRpbHMucmVzb3VyY2VMb29rdXAocmVmZXJlbmNlKSk7CiAgICAgICAgfSwgMjAwKTsKICAgICAgfSBlbHNlIGlmICghZmhpcnV0aWxzLl9jb2RlX2NhY2hlW2xvb2t1cF0pIHsKICAgICAgICBmaGlydXRpbHMuX2NvZGVfbG9hZGluZ1tsb29rdXBdID0gdHJ1ZTsKICAgICAgICBheGlvcy5nZXQoIi9maGlyLyRzaG9ydC1uYW1lP3JlZmVyZW5jZT0iICsgcmVmZXJlbmNlKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICAgIGlmIChkYXRhLmRpc3BsYXkpIHsKICAgICAgICAgICAgcmVzb2x2ZShmaGlydXRpbHMuX3NldENhY2hlKGxvb2t1cCwgZGF0YS5kaXNwbGF5KSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmxvZygiTm8gZGlzcGxheSBkYXRhIGZyb20gcmVmZXJlbmNlIGZvdW5kICIsIGxvb2t1cCwgZGF0YSk7CiAgICAgICAgICAgIHJlc29sdmUoZmhpcnV0aWxzLl9zZXRDYWNoZShsb29rdXAsIHJlZmVyZW5jZSkpOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7CiAgICAgICAgICByZXNvbHZlKGZoaXJ1dGlscy5fc2V0Q2FjaGUobG9va3VwLCByZWZlcmVuY2UpKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXNvbHZlKGZoaXJ1dGlscy5fY29kZV9jYWNoZVtsb29rdXBdKTsKICAgICAgfQogICAgfSk7CiAgfSwKICBjb2RlTG9va3VwOiBmdW5jdGlvbiBjb2RlTG9va3VwKHN5c3RlbSwgY29kZSwgYmluZGluZykgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgIHZhciBsb29rdXAgPSBzeXN0ZW0gKyAiIyIgKyBjb2RlOwoKICAgICAgaWYgKGZoaXJ1dGlscy5fY29kZV9sb2FkaW5nW2xvb2t1cF0pIHsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJlc29sdmUoZmhpcnV0aWxzLmNvZGVMb29rdXAoc3lzdGVtLCBjb2RlLCBiaW5kaW5nKSk7CiAgICAgICAgfSwgMjAwKTsKICAgICAgfSBlbHNlIGlmICghZmhpcnV0aWxzLl9jb2RlX2NhY2hlW2xvb2t1cF0pIHsKICAgICAgICBmaGlydXRpbHMuX2NvZGVfbG9hZGluZ1tsb29rdXBdID0gdHJ1ZTsKICAgICAgICBheGlvcy5nZXQoIi9maGlyLyRzaG9ydC1uYW1lP3N5c3RlbT0iICsgc3lzdGVtICsgIiZjb2RlPSIgKyBjb2RlICsgIiZ2YWx1c2V0PSIgKyBiaW5kaW5nKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhOwoKICAgICAgICAgIGlmIChkYXRhLmRpc3BsYXkpIHsKICAgICAgICAgICAgcmVzb2x2ZShmaGlydXRpbHMuX3NldENhY2hlKGxvb2t1cCwgZGF0YS5kaXNwbGF5KSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmxvZygiTm8gZGlzcGxheSBkYXRhIGZyb20gY29kZXN5c3RlbSBmb3VuZCAiLCBsb29rdXAsIGRhdGEpOwogICAgICAgICAgICByZXNvbHZlKGZoaXJ1dGlscy5fc2V0Q2FjaGUobG9va3VwLCBjb2RlKSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgICAgY29uc29sZS5sb2coZXJyKTsKICAgICAgICAgIHJlc29sdmUoZmhpcnV0aWxzLl9zZXRDYWNoZShsb29rdXAsIGNvZGUpKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXNvbHZlKGZoaXJ1dGlscy5fY29kZV9jYWNoZVtsb29rdXBdKTsKICAgICAgfQogICAgfSk7CiAgfSwKICBwYXRoRmllbGRFeHByZXNzaW9uOiBmdW5jdGlvbiBwYXRoRmllbGRFeHByZXNzaW9uKGZpZWxkKSB7CiAgICB2YXIgZXhwcmVzc2lvbiA9IGZpZWxkLnN1YnN0cmluZyhmaWVsZC5pbmRleE9mKCc6JykgKyAxKTsKCiAgICBpZiAoZXhwcmVzc2lvbi5pbmNsdWRlcygnLScpIHx8IGV4cHJlc3Npb24uaW5jbHVkZXMoJy4nKSkgewogICAgICByZXR1cm4gJ2AnICsgZXhwcmVzc2lvbiArICdgJzsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBleHByZXNzaW9uOwogICAgfQogIH0sCiAgZXhwYW5kOiBmdW5jdGlvbiBleHBhbmQodmFsdWVzZXQpIHsKICAgIHZhciBpdGVtU29ydCA9IGZ1bmN0aW9uIGl0ZW1Tb3J0KGEsIGIpIHsKICAgICAgcmV0dXJuIGEuZGlzcGxheSA9PT0gYi5kaXNwbGF5ID8gYS5jb2RlID09PSBiLmNvZGUgPyAwIDogYS5jb2RlIDwgYi5jb2RlID8gLTEgOiAxIDogYS5kaXNwbGF5IDwgYi5kaXNwbGF5ID8gLTEgOiAxOwogICAgfTsKCiAgICB2YXIgcG9wdWxhdGVJdGVtc0Zyb21Db21wb3NlID0gZnVuY3Rpb24gcG9wdWxhdGVJdGVtc0Zyb21Db21wb3NlKHZhbHVlc2V0LCBpdGVtcykgewogICAgICBpZiAodmFsdWVzZXQuY29tcG9zZS5pbmNsdWRlKSB7CiAgICAgICAgdmFyIF9pdGVyYXRvcjIgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih2YWx1ZXNldC5jb21wb3NlLmluY2x1ZGUpLAogICAgICAgICAgICBfc3RlcDI7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKF9pdGVyYXRvcjIucygpOyAhKF9zdGVwMiA9IF9pdGVyYXRvcjIubigpKS5kb25lOykgewogICAgICAgICAgICB2YXIgaW5jbHVkZSA9IF9zdGVwMi52YWx1ZTsKCiAgICAgICAgICAgIGlmIChpbmNsdWRlLmNvbmNlcHQpIHsKICAgICAgICAgICAgICB2YXIgX2l0ZXJhdG9yMyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGluY2x1ZGUuY29uY2VwdCksCiAgICAgICAgICAgICAgICAgIF9zdGVwMzsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgICAgIHZhciBjb25jZXB0ID0gX3N0ZXAzLnZhbHVlOwogICAgICAgICAgICAgICAgICBjb25jZXB0LnN5c3RlbSA9IGluY2x1ZGUuc3lzdGVtOwogICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKGNvbmNlcHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgX2l0ZXJhdG9yMy5lKGVycik7CiAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIF9pdGVyYXRvcjMuZigpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgX2l0ZXJhdG9yMi5lKGVycik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIF9pdGVyYXRvcjIuZigpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICB2YXIgbGFzdFNsYXNoID0gdmFsdWVzZXQubGFzdEluZGV4T2YoJy8nKTsKICAgICAgdmFyIGxhc3RQaXBlID0gdmFsdWVzZXQubGFzdEluZGV4T2YoJ3wnKTsKICAgICAgdmFyIHZhbHVlU2V0SWQgPSB2YWx1ZXNldC5zbGljZShsYXN0U2xhc2ggKyAxLCBsYXN0UGlwZSAhPT0gLTEgPyBsYXN0UGlwZSA6IHZhbHVlc2V0Lmxlbmd0aCk7CiAgICAgIHZhciBpdGVtcyA9IFtdOwogICAgICBheGlvcy5nZXQoIi9maGlyL1ZhbHVlU2V0LyIgKyB2YWx1ZVNldElkICsgIi8kZXhwYW5kIikudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoKCFkYXRhLmV4cGFuc2lvbiB8fCBkYXRhLmV4cGFuc2lvbi50b3RhbCA9PT0gMCkgJiYgZGF0YS5jb21wb3NlLmluY2x1ZGUpIHsKICAgICAgICAgICAgcG9wdWxhdGVJdGVtc0Zyb21Db21wb3NlKGRhdGEsIGl0ZW1zKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGl0ZW1zID0gZGF0YS5leHBhbnNpb24uY29udGFpbnM7CiAgICAgICAgICB9CgogICAgICAgICAgaXRlbXMuc29ydChpdGVtU29ydCk7CiAgICAgICAgICByZXNvbHZlKGl0ZW1zKTsKICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7CiAgICAgICAgICByZWplY3QobmV3IEVycm9yKCJJbnZhbGlkIHJlc3BvbnNlIGZyb20gc2VydmVyLiIpKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBheGlvcy5nZXQoIi9maGlyL1ZhbHVlU2V0LyIgKyB2YWx1ZVNldElkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgdmFyIGRhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgcG9wdWxhdGVJdGVtc0Zyb21Db21wb3NlKGRhdGEsIGl0ZW1zKTsKICAgICAgICAgIGl0ZW1zLnNvcnQoaXRlbVNvcnQpOwogICAgICAgICAgcmVzb2x2ZShpdGVtcyk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgICAgcmVqZWN0KGVycik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CiAgfQp9OwpleHBvcnQgZGVmYXVsdCBmaGlydXRpbHM7"},{"version":3,"sources":["/home/ally/gofr/facility-recon-gui/src/plugins/fhirutils.js"],"names":["fhirpath","require","axios","fhirutils","_code_cache","_code_loading","_setCache","lookup","value","checkConstraints","constraintList","constraintDetails","element","errors","fhirId","Promise","resolve","reject","constraints","split","promises","constraint","results","evaluate","expression","startsWith","resource","shift","query","length","push","encodeURI","get","join","then","response","bundle","data","total","ids","entry","includes","human","catch","err","every","Boolean","all","display","defaultSystem","codeLookup","system","code","reference","resourceLookup","test","setTimeout","console","log","binding","pathFieldExpression","field","substring","indexOf","expand","valueset","itemSort","a","b","populateItemsFromCompose","items","compose","include","concept","lastSlash","lastIndexOf","lastPipe","valueSetId","slice","expansion","contains","sort","Error"],"mappings":"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","sourcesContent":["const fhirpath = require('fhirpath')\nconst axios = require('axios')\n\nconst fhirutils = {\n  _code_cache: {},\n  _code_loading: {},\n  _setCache: ( lookup, value ) => {\n    fhirutils._code_cache[lookup] = value\n    fhirutils._code_loading[lookup] = false\n    return value\n  },\n  checkConstraints: ( constraintList, constraintDetails, element, errors, fhirId ) => {\n    return new Promise( (resolve, reject) => {\n      let constraints = constraintList.split(\",\")\n      let promises = []\n      for( let constraint of constraints ) {\n        if ( constraintDetails[constraint] ) {\n          let results = fhirpath.evaluate(element, constraintDetails[constraint].expression)\n          if ( constraint.startsWith('ihris-search') ) {\n            let resource = results.shift()\n            let query = [ \"_elements=id\" ]\n            while ( results.length ) {\n              query.push( results.shift() + \"=\" + encodeURI( results.shift() ) )\n            }\n            promises.push( new Promise( (resolve, reject) => {\n              axios.get( \"/fhir/\"+resource+\"?\"+query.join(\"&\") ).then( response => {\n                let bundle = response.data\n                if ( bundle.total === 0 ) {\n                  resolve( true )\n                } else if ( fhirId ) {\n                  let ids = fhirpath.evaluate( bundle.entry, \"resource.id\" )\n                  if ( ids.includes( fhirId ) ) {\n                    // This is the record that matched\n                    resolve( true )\n                  } else {\n                    errors.push( constraintDetails[constraint].human )\n                    resolve( false )\n                  }\n                } else {\n                  errors.push( constraintDetails[constraint].human )\n                  resolve( false )\n                }\n              } ).catch( err => {\n                reject( err )\n              } )\n            } ) )\n          } else if ( !results.every(Boolean) ) {\n            errors.push( constraintDetails[constraint].human )\n            promises.push( false )\n          } else {\n            promises.push( true )\n          }\n        }\n      }\n      Promise.all( promises ).then( results => {\n        if ( results.every(Boolean) ) {\n          resolve(true)\n        } else {\n          resolve(false)\n        }\n      } ).catch( err => {\n        reject( err )\n      } )\n    } )\n  },\n  lookup: ( display, defaultSystem ) => {\n    if ( !display ) {\n      return new Promise( resolve => resolve(display) )\n    }\n    if ( defaultSystem ) {\n      return fhirutils.codeLookup( defaultSystem, display )\n    } else if ( display.system && display.code ) {\n      return fhirutils.codeLookup( display.system, display.code )\n    } else if ( display.reference ) {\n      return fhirutils.resourceLookup( display.reference )\n    } else if ( /([A-Z]\\w*)\\/([A-Za-z0-9\\-.]{1,64})/.test( display ) ) {\n      return fhirutils.resourceLookup( display )\n    } else {\n      return new Promise( resolve => resolve(display) )\n    }\n  },\n  resourceLookup: ( reference ) => {\n    return new Promise( (resolve) => {\n      let lookup = reference\n      if ( fhirutils._code_loading[lookup] ) {\n        setTimeout( () => {\n          resolve( fhirutils.resourceLookup( reference ) )\n        }, 200 )\n      } else if ( !fhirutils._code_cache[lookup] ) {\n        fhirutils._code_loading[lookup] = true\n        axios.get( \"/fhir/$short-name?reference=\"+reference ).then( response => {\n          let data = response.data\n          if ( data.display ) {\n            resolve( fhirutils._setCache( lookup, data.display ) )\n          } else {\n            console.log(\"No display data from reference found \",lookup,data)\n            resolve( fhirutils._setCache( lookup, reference ) )\n          }\n        } ).catch( err => {\n          console.log(err)\n          resolve( fhirutils._setCache( lookup, reference ) )\n        } )\n      } else {\n        resolve( fhirutils._code_cache[lookup] )\n      }\n    } )\n  },\n  codeLookup: ( system, code, binding ) => {\n    return new Promise( (resolve) => {\n      let lookup = system + \"#\" + code\n      if ( fhirutils._code_loading[lookup] ) {\n        setTimeout( () => {\n          resolve( fhirutils.codeLookup( system, code, binding ) )\n        }, 200 )\n      } else if ( !fhirutils._code_cache[lookup] ) {\n        fhirutils._code_loading[lookup] = true\n        axios.get( \"/fhir/$short-name?system=\"+system+\"&code=\"+code+\"&valuset=\"+binding ).then( response => {\n          let data = response.data\n          if ( data.display ) {\n            resolve( fhirutils._setCache( lookup, data.display ) )\n          } else {\n            console.log(\"No display data from codesystem found \",lookup,data)\n            resolve( fhirutils._setCache( lookup, code ) )\n          }\n        } ).catch( err => {\n          console.log(err)\n          resolve( fhirutils._setCache( lookup, code ) )\n        } )\n      } else {\n        resolve( fhirutils._code_cache[lookup] )\n      }\n    } )\n  },\n  pathFieldExpression: (field) => {\n    let expression = field.substring( field.indexOf(':')+1 )\n    if ( expression.includes('-') || expression.includes('.') ) {\n      return '`'+expression+'`'\n    } else {\n      return expression\n    }\n  },\n  expand: (valueset) => {\n    const itemSort = (a,b) => {\n      return (a.display === b.display ? (a.code === b.code ? 0 : (a.code < b.code ? -1: 1)) : (a.display < b.display ? -1 : 1) )\n    }\n    const populateItemsFromCompose = ( valueset, items ) => {\n      if ( valueset.compose.include ) {\n        for( let include of valueset.compose.include ) {\n          if ( include.concept ) {\n            for ( let concept of include.concept ) {\n              concept.system = include.system\n              items.push( concept )\n            }\n          }\n        }\n      }\n    }\n    return new Promise( (resolve, reject) => {\n      let lastSlash = valueset.lastIndexOf('/')\n      let lastPipe = valueset.lastIndexOf('|')\n      let valueSetId = valueset.slice(lastSlash+1, (lastPipe !== -1 ? lastPipe : valueset.length ))\n      let items = []\n\n      axios.get(\"/fhir/ValueSet/\"+valueSetId+\"/$expand\").then(response=> {\n        let data = response.data\n        try {\n          if ( ( !data.expansion || data.expansion.total === 0 ) && data.compose.include ) {\n            populateItemsFromCompose( data, items )\n          } else {\n            items = data.expansion.contains\n          }\n          items.sort( itemSort )\n          resolve( items )\n        } catch(err) {\n          console.log(err)\n          reject( new Error( \"Invalid response from server.\" ) )\n        }\n      }).catch(() => {\n        axios.get(\"/fhir/ValueSet/\"+valueSetId).then(response=> {\n          let data = response.data\n          populateItemsFromCompose( data, items )\n          items.sort( itemSort )\n          resolve( items )\n        }).catch(err=>{\n          reject(err)\n        })\n      })\n    } )\n  }\n}\n\nexport default fhirutils\n"]}]}