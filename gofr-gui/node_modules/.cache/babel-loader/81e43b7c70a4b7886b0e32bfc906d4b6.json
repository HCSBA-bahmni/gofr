{"remainingRequest":"/home/ally/gofr/gofr-gui/node_modules/babel-loader/lib/index.js!/home/ally/gofr/gofr-gui/node_modules/eslint-loader/index.js??ref--13-0!/home/ally/gofr/gofr-gui/src/plugins/fhirutils.js","dependencies":[{"path":"/home/ally/gofr/gofr-gui/src/plugins/fhirutils.js","mtime":1619351477615},{"path":"/home/ally/gofr/gofr-gui/node_modules/cache-loader/dist/cjs.js","mtime":1619257191457},{"path":"/home/ally/gofr/gofr-gui/node_modules/babel-loader/lib/index.js","mtime":1619257191453},{"path":"/home/ally/gofr/gofr-gui/node_modules/eslint-loader/index.js","mtime":1619257191105}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9ob21lL2FsbHkvZ29mci9nb2ZyLWd1aS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3RhcnRzLXdpdGguanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZS5qcyI7Cgp2YXIgZmhpcnBhdGggPSByZXF1aXJlKCdmaGlycGF0aCcpOwoKdmFyIGF4aW9zID0gcmVxdWlyZSgnYXhpb3MnKTsKCnZhciBmaGlydXRpbHMgPSB7CiAgX2NvZGVfY2FjaGU6IHt9LAogIF9jb2RlX2xvYWRpbmc6IHt9LAogIF9zZXRDYWNoZTogZnVuY3Rpb24gX3NldENhY2hlKGxvb2t1cCwgdmFsdWUpIHsKICAgIGZoaXJ1dGlscy5fY29kZV9jYWNoZVtsb29rdXBdID0gdmFsdWU7CiAgICBmaGlydXRpbHMuX2NvZGVfbG9hZGluZ1tsb29rdXBdID0gZmFsc2U7CiAgICByZXR1cm4gdmFsdWU7CiAgfSwKICBjaGVja0NvbnN0cmFpbnRzOiBmdW5jdGlvbiBjaGVja0NvbnN0cmFpbnRzKGNvbnN0cmFpbnRMaXN0LCBjb25zdHJhaW50RGV0YWlscywgZWxlbWVudCwgZXJyb3JzLCBmaGlySWQpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIHZhciBjb25zdHJhaW50cyA9IGNvbnN0cmFpbnRMaXN0LnNwbGl0KCIsIik7CiAgICAgIHZhciBwcm9taXNlcyA9IFtdOwoKICAgICAgdmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGNvbnN0cmFpbnRzKSwKICAgICAgICAgIF9zdGVwOwoKICAgICAgdHJ5IHsKICAgICAgICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcCgpIHsKICAgICAgICAgIHZhciBjb25zdHJhaW50ID0gX3N0ZXAudmFsdWU7CgogICAgICAgICAgaWYgKGNvbnN0cmFpbnREZXRhaWxzW2NvbnN0cmFpbnRdKSB7CiAgICAgICAgICAgIHZhciByZXN1bHRzID0gZmhpcnBhdGguZXZhbHVhdGUoZWxlbWVudCwgY29uc3RyYWludERldGFpbHNbY29uc3RyYWludF0uZXhwcmVzc2lvbik7CgogICAgICAgICAgICBpZiAoY29uc3RyYWludC5zdGFydHNXaXRoKCdpaHJpcy1zZWFyY2gnKSkgewogICAgICAgICAgICAgIHZhciByZXNvdXJjZSA9IHJlc3VsdHMuc2hpZnQoKTsKICAgICAgICAgICAgICB2YXIgcXVlcnkgPSBbIl9lbGVtZW50cz1pZCJdOwoKICAgICAgICAgICAgICB3aGlsZSAocmVzdWx0cy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHF1ZXJ5LnB1c2gocmVzdWx0cy5zaGlmdCgpICsgIj0iICsgZW5jb2RlVVJJKHJlc3VsdHMuc2hpZnQoKSkpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcHJvbWlzZXMucHVzaChuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgICBheGlvcy5nZXQoIi9maGlyLyIgKyByZXNvdXJjZSArICI/IiArIHF1ZXJ5LmpvaW4oIiYiKSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgdmFyIGJ1bmRsZSA9IHJlc3BvbnNlLmRhdGE7CgogICAgICAgICAgICAgICAgICBpZiAoYnVuZGxlLnRvdGFsID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmaGlySWQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaWRzID0gZmhpcnBhdGguZXZhbHVhdGUoYnVuZGxlLmVudHJ5LCAicmVzb3VyY2UuaWQiKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGlkcy5pbmNsdWRlcyhmaGlySWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSByZWNvcmQgdGhhdCBtYXRjaGVkCiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBlcnJvcnMucHVzaChjb25zdHJhaW50RGV0YWlsc1tjb25zdHJhaW50XS5odW1hbik7CiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goY29uc3RyYWludERldGFpbHNbY29uc3RyYWludF0uaHVtYW4pOwogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZmFsc2UpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB9IGVsc2UgaWYgKCFyZXN1bHRzLmV2ZXJ5KEJvb2xlYW4pKSB7CiAgICAgICAgICAgICAgZXJyb3JzLnB1c2goY29uc3RyYWludERldGFpbHNbY29uc3RyYWludF0uaHVtYW4pOwogICAgICAgICAgICAgIHByb21pc2VzLnB1c2goZmFsc2UpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHByb21pc2VzLnB1c2godHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykgewogICAgICAgICAgX2xvb3AoKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvci5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgfQoKICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdHMpIHsKICAgICAgICBpZiAocmVzdWx0cy5ldmVyeShCb29sZWFuKSkgewogICAgICAgICAgcmVzb2x2ZSh0cnVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzb2x2ZShmYWxzZSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgcmVqZWN0KGVycik7CiAgICAgIH0pOwogICAgfSk7CiAgfSwKICBsb29rdXA6IGZ1bmN0aW9uIGxvb2t1cChkaXNwbGF5LCBkZWZhdWx0U3lzdGVtKSB7CiAgICBpZiAoIWRpc3BsYXkpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgcmV0dXJuIHJlc29sdmUoZGlzcGxheSk7CiAgICAgIH0pOwogICAgfQoKICAgIGlmIChkZWZhdWx0U3lzdGVtKSB7CiAgICAgIHJldHVybiBmaGlydXRpbHMuY29kZUxvb2t1cChkZWZhdWx0U3lzdGVtLCBkaXNwbGF5KTsKICAgIH0gZWxzZSBpZiAoZGlzcGxheS5zeXN0ZW0gJiYgZGlzcGxheS5jb2RlKSB7CiAgICAgIHJldHVybiBmaGlydXRpbHMuY29kZUxvb2t1cChkaXNwbGF5LnN5c3RlbSwgZGlzcGxheS5jb2RlKTsKICAgIH0gZWxzZSBpZiAoZGlzcGxheS5yZWZlcmVuY2UpIHsKICAgICAgcmV0dXJuIGZoaXJ1dGlscy5yZXNvdXJjZUxvb2t1cChkaXNwbGF5LnJlZmVyZW5jZSk7CiAgICB9IGVsc2UgaWYgKC8oW0EtWl1cdyopXC8oW0EtWmEtejAtOVwtLl17MSw2NH0pLy50ZXN0KGRpc3BsYXkpKSB7CiAgICAgIHJldHVybiBmaGlydXRpbHMucmVzb3VyY2VMb29rdXAoZGlzcGxheSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICByZXR1cm4gcmVzb2x2ZShkaXNwbGF5KTsKICAgICAgfSk7CiAgICB9CiAgfSwKICByZXNvdXJjZUxvb2t1cDogZnVuY3Rpb24gcmVzb3VyY2VMb29rdXAocmVmZXJlbmNlKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgdmFyIGxvb2t1cCA9IHJlZmVyZW5jZTsKCiAgICAgIGlmIChmaGlydXRpbHMuX2NvZGVfbG9hZGluZ1tsb29rdXBdKSB7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXNvbHZlKGZoaXJ1dGlscy5yZXNvdXJjZUxvb2t1cChyZWZlcmVuY2UpKTsKICAgICAgICB9LCAyMDApOwogICAgICB9IGVsc2UgaWYgKCFmaGlydXRpbHMuX2NvZGVfY2FjaGVbbG9va3VwXSkgewogICAgICAgIGZoaXJ1dGlscy5fY29kZV9sb2FkaW5nW2xvb2t1cF0gPSB0cnVlOwogICAgICAgIGF4aW9zLmdldCgiL2ZoaXIvJHNob3J0LW5hbWU/cmVmZXJlbmNlPSIgKyByZWZlcmVuY2UpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CgogICAgICAgICAgaWYgKGRhdGEuZGlzcGxheSkgewogICAgICAgICAgICByZXNvbHZlKGZoaXJ1dGlscy5fc2V0Q2FjaGUobG9va3VwLCBkYXRhLmRpc3BsYXkpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJObyBkaXNwbGF5IGRhdGEgZnJvbSByZWZlcmVuY2UgZm91bmQgIiwgbG9va3VwLCBkYXRhKTsKICAgICAgICAgICAgcmVzb2x2ZShmaGlydXRpbHMuX3NldENhY2hlKGxvb2t1cCwgcmVmZXJlbmNlKSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgICAgY29uc29sZS5sb2coZXJyKTsKICAgICAgICAgIHJlc29sdmUoZmhpcnV0aWxzLl9zZXRDYWNoZShsb29rdXAsIHJlZmVyZW5jZSkpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHJlc29sdmUoZmhpcnV0aWxzLl9jb2RlX2NhY2hlW2xvb2t1cF0pOwogICAgICB9CiAgICB9KTsKICB9LAogIGNvZGVMb29rdXA6IGZ1bmN0aW9uIGNvZGVMb29rdXAoc3lzdGVtLCBjb2RlLCBiaW5kaW5nKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgdmFyIGxvb2t1cCA9IHN5c3RlbSArICIjIiArIGNvZGU7CgogICAgICBpZiAoZmhpcnV0aWxzLl9jb2RlX2xvYWRpbmdbbG9va3VwXSkgewogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmVzb2x2ZShmaGlydXRpbHMuY29kZUxvb2t1cChzeXN0ZW0sIGNvZGUsIGJpbmRpbmcpKTsKICAgICAgICB9LCAyMDApOwogICAgICB9IGVsc2UgaWYgKCFmaGlydXRpbHMuX2NvZGVfY2FjaGVbbG9va3VwXSkgewogICAgICAgIGZoaXJ1dGlscy5fY29kZV9sb2FkaW5nW2xvb2t1cF0gPSB0cnVlOwogICAgICAgIGF4aW9zLmdldCgiL2ZoaXIvJHNob3J0LW5hbWU/c3lzdGVtPSIgKyBzeXN0ZW0gKyAiJmNvZGU9IiArIGNvZGUgKyAiJnZhbHVzZXQ9IiArIGJpbmRpbmcpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CgogICAgICAgICAgaWYgKGRhdGEuZGlzcGxheSkgewogICAgICAgICAgICByZXNvbHZlKGZoaXJ1dGlscy5fc2V0Q2FjaGUobG9va3VwLCBkYXRhLmRpc3BsYXkpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJObyBkaXNwbGF5IGRhdGEgZnJvbSBjb2Rlc3lzdGVtIGZvdW5kICIsIGxvb2t1cCwgZGF0YSk7CiAgICAgICAgICAgIHJlc29sdmUoZmhpcnV0aWxzLl9zZXRDYWNoZShsb29rdXAsIGNvZGUpKTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpOwogICAgICAgICAgcmVzb2x2ZShmaGlydXRpbHMuX3NldENhY2hlKGxvb2t1cCwgY29kZSkpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHJlc29sdmUoZmhpcnV0aWxzLl9jb2RlX2NhY2hlW2xvb2t1cF0pOwogICAgICB9CiAgICB9KTsKICB9LAogIHBhdGhGaWVsZEV4cHJlc3Npb246IGZ1bmN0aW9uIHBhdGhGaWVsZEV4cHJlc3Npb24oZmllbGQpIHsKICAgIHZhciBleHByZXNzaW9uID0gZmllbGQuc3Vic3RyaW5nKGZpZWxkLmluZGV4T2YoJzonKSArIDEpOwoKICAgIGlmIChleHByZXNzaW9uLmluY2x1ZGVzKCctJykgfHwgZXhwcmVzc2lvbi5pbmNsdWRlcygnLicpKSB7CiAgICAgIHJldHVybiAnYCcgKyBleHByZXNzaW9uICsgJ2AnOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGV4cHJlc3Npb247CiAgICB9CiAgfSwKICBleHBhbmQ6IGZ1bmN0aW9uIGV4cGFuZCh2YWx1ZXNldCkgewogICAgdmFyIGl0ZW1Tb3J0ID0gZnVuY3Rpb24gaXRlbVNvcnQoYSwgYikgewogICAgICByZXR1cm4gYS5kaXNwbGF5ID09PSBiLmRpc3BsYXkgPyBhLmNvZGUgPT09IGIuY29kZSA/IDAgOiBhLmNvZGUgPCBiLmNvZGUgPyAtMSA6IDEgOiBhLmRpc3BsYXkgPCBiLmRpc3BsYXkgPyAtMSA6IDE7CiAgICB9OwoKICAgIHZhciBwb3B1bGF0ZUl0ZW1zRnJvbUNvbXBvc2UgPSBmdW5jdGlvbiBwb3B1bGF0ZUl0ZW1zRnJvbUNvbXBvc2UodmFsdWVzZXQsIGl0ZW1zKSB7CiAgICAgIGlmICh2YWx1ZXNldC5jb21wb3NlLmluY2x1ZGUpIHsKICAgICAgICB2YXIgX2l0ZXJhdG9yMiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHZhbHVlc2V0LmNvbXBvc2UuaW5jbHVkZSksCiAgICAgICAgICAgIF9zdGVwMjsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgIHZhciBpbmNsdWRlID0gX3N0ZXAyLnZhbHVlOwoKICAgICAgICAgICAgaWYgKGluY2x1ZGUuY29uY2VwdCkgewogICAgICAgICAgICAgIHZhciBfaXRlcmF0b3IzID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoaW5jbHVkZS5jb25jZXB0KSwKICAgICAgICAgICAgICAgICAgX3N0ZXAzOwoKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZm9yIChfaXRlcmF0b3IzLnMoKTsgIShfc3RlcDMgPSBfaXRlcmF0b3IzLm4oKSkuZG9uZTspIHsKICAgICAgICAgICAgICAgICAgdmFyIGNvbmNlcHQgPSBfc3RlcDMudmFsdWU7CiAgICAgICAgICAgICAgICAgIGNvbmNlcHQuc3lzdGVtID0gaW5jbHVkZS5zeXN0ZW07CiAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goY29uY2VwdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3IzLmUoZXJyKTsKICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgX2l0ZXJhdG9yMy5mKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICBfaXRlcmF0b3IyLmUoZXJyKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgX2l0ZXJhdG9yMi5mKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIHZhciBsYXN0U2xhc2ggPSB2YWx1ZXNldC5sYXN0SW5kZXhPZignLycpOwogICAgICB2YXIgbGFzdFBpcGUgPSB2YWx1ZXNldC5sYXN0SW5kZXhPZignfCcpOwogICAgICB2YXIgdmFsdWVTZXRJZCA9IHZhbHVlc2V0LnNsaWNlKGxhc3RTbGFzaCArIDEsIGxhc3RQaXBlICE9PSAtMSA/IGxhc3RQaXBlIDogdmFsdWVzZXQubGVuZ3RoKTsKICAgICAgdmFyIGl0ZW1zID0gW107CiAgICAgIGF4aW9zLmdldCgiL2ZoaXIvVmFsdWVTZXQvIiArIHZhbHVlU2V0SWQgKyAiLyRleHBhbmQiKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIHZhciBkYXRhID0gcmVzcG9uc2UuZGF0YTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmICgoIWRhdGEuZXhwYW5zaW9uIHx8IGRhdGEuZXhwYW5zaW9uLnRvdGFsID09PSAwKSAmJiBkYXRhLmNvbXBvc2UuaW5jbHVkZSkgewogICAgICAgICAgICBwb3B1bGF0ZUl0ZW1zRnJvbUNvbXBvc2UoZGF0YSwgaXRlbXMpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaXRlbXMgPSBkYXRhLmV4cGFuc2lvbi5jb250YWluczsKICAgICAgICAgIH0KCiAgICAgICAgICBpdGVtcy5zb3J0KGl0ZW1Tb3J0KTsKICAgICAgICAgIHJlc29sdmUoaXRlbXMpOwogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgY29uc29sZS5sb2coZXJyKTsKICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoIkludmFsaWQgcmVzcG9uc2UgZnJvbSBzZXJ2ZXIuIikpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIGF4aW9zLmdldCgiL2ZoaXIvVmFsdWVTZXQvIiArIHZhbHVlU2V0SWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICBwb3B1bGF0ZUl0ZW1zRnJvbUNvbXBvc2UoZGF0YSwgaXRlbXMpOwogICAgICAgICAgaXRlbXMuc29ydChpdGVtU29ydCk7CiAgICAgICAgICByZXNvbHZlKGl0ZW1zKTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICByZWplY3QoZXJyKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KTsKICB9Cn07CmV4cG9ydCBkZWZhdWx0IGZoaXJ1dGlsczs="},{"version":3,"sources":["/home/ally/gofr/gofr-gui/src/plugins/fhirutils.js"],"names":["fhirpath","require","axios","fhirutils","_code_cache","_code_loading","_setCache","lookup","value","checkConstraints","constraintList","constraintDetails","element","errors","fhirId","Promise","resolve","reject","constraints","split","promises","constraint","results","evaluate","expression","startsWith","resource","shift","query","length","push","encodeURI","get","join","then","response","bundle","data","total","ids","entry","includes","human","catch","err","every","Boolean","all","display","defaultSystem","codeLookup","system","code","reference","resourceLookup","test","setTimeout","console","log","binding","pathFieldExpression","field","substring","indexOf","expand","valueset","itemSort","a","b","populateItemsFromCompose","items","compose","include","concept","lastSlash","lastIndexOf","lastPipe","valueSetId","slice","expansion","contains","sort","Error"],"mappings":"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","sourcesContent":["const fhirpath = require('fhirpath')\nconst axios = require('axios')\n\nconst fhirutils = {\n  _code_cache: {},\n  _code_loading: {},\n  _setCache: ( lookup, value ) => {\n    fhirutils._code_cache[lookup] = value\n    fhirutils._code_loading[lookup] = false\n    return value\n  },\n  checkConstraints: ( constraintList, constraintDetails, element, errors, fhirId ) => {\n    return new Promise( (resolve, reject) => {\n      let constraints = constraintList.split(\",\")\n      let promises = []\n      for( let constraint of constraints ) {\n        if ( constraintDetails[constraint] ) {\n          let results = fhirpath.evaluate(element, constraintDetails[constraint].expression)\n          if ( constraint.startsWith('ihris-search') ) {\n            let resource = results.shift()\n            let query = [ \"_elements=id\" ]\n            while ( results.length ) {\n              query.push( results.shift() + \"=\" + encodeURI( results.shift() ) )\n            }\n            promises.push( new Promise( (resolve, reject) => {\n              axios.get( \"/fhir/\"+resource+\"?\"+query.join(\"&\") ).then( response => {\n                let bundle = response.data\n                if ( bundle.total === 0 ) {\n                  resolve( true )\n                } else if ( fhirId ) {\n                  let ids = fhirpath.evaluate( bundle.entry, \"resource.id\" )\n                  if ( ids.includes( fhirId ) ) {\n                    // This is the record that matched\n                    resolve( true )\n                  } else {\n                    errors.push( constraintDetails[constraint].human )\n                    resolve( false )\n                  }\n                } else {\n                  errors.push( constraintDetails[constraint].human )\n                  resolve( false )\n                }\n              } ).catch( err => {\n                reject( err )\n              } )\n            } ) )\n          } else if ( !results.every(Boolean) ) {\n            errors.push( constraintDetails[constraint].human )\n            promises.push( false )\n          } else {\n            promises.push( true )\n          }\n        }\n      }\n      Promise.all( promises ).then( results => {\n        if ( results.every(Boolean) ) {\n          resolve(true)\n        } else {\n          resolve(false)\n        }\n      } ).catch( err => {\n        reject( err )\n      } )\n    } )\n  },\n  lookup: ( display, defaultSystem ) => {\n    if ( !display ) {\n      return new Promise( resolve => resolve(display) )\n    }\n    if ( defaultSystem ) {\n      return fhirutils.codeLookup( defaultSystem, display )\n    } else if ( display.system && display.code ) {\n      return fhirutils.codeLookup( display.system, display.code )\n    } else if ( display.reference ) {\n      return fhirutils.resourceLookup( display.reference )\n    } else if ( /([A-Z]\\w*)\\/([A-Za-z0-9\\-.]{1,64})/.test( display ) ) {\n      return fhirutils.resourceLookup( display )\n    } else {\n      return new Promise( resolve => resolve(display) )\n    }\n  },\n  resourceLookup: ( reference ) => {\n    return new Promise( (resolve) => {\n      let lookup = reference\n      if ( fhirutils._code_loading[lookup] ) {\n        setTimeout( () => {\n          resolve( fhirutils.resourceLookup( reference ) )\n        }, 200 )\n      } else if ( !fhirutils._code_cache[lookup] ) {\n        fhirutils._code_loading[lookup] = true\n        axios.get( \"/fhir/$short-name?reference=\"+reference ).then( response => {\n          let data = response.data\n          if ( data.display ) {\n            resolve( fhirutils._setCache( lookup, data.display ) )\n          } else {\n            console.log(\"No display data from reference found \",lookup,data)\n            resolve( fhirutils._setCache( lookup, reference ) )\n          }\n        } ).catch( err => {\n          console.log(err)\n          resolve( fhirutils._setCache( lookup, reference ) )\n        } )\n      } else {\n        resolve( fhirutils._code_cache[lookup] )\n      }\n    } )\n  },\n  codeLookup: ( system, code, binding ) => {\n    return new Promise( (resolve) => {\n      let lookup = system + \"#\" + code\n      if ( fhirutils._code_loading[lookup] ) {\n        setTimeout( () => {\n          resolve( fhirutils.codeLookup( system, code, binding ) )\n        }, 200 )\n      } else if ( !fhirutils._code_cache[lookup] ) {\n        fhirutils._code_loading[lookup] = true\n        axios.get( \"/fhir/$short-name?system=\"+system+\"&code=\"+code+\"&valuset=\"+binding ).then( response => {\n          let data = response.data\n          if ( data.display ) {\n            resolve( fhirutils._setCache( lookup, data.display ) )\n          } else {\n            console.log(\"No display data from codesystem found \",lookup,data)\n            resolve( fhirutils._setCache( lookup, code ) )\n          }\n        } ).catch( err => {\n          console.log(err)\n          resolve( fhirutils._setCache( lookup, code ) )\n        } )\n      } else {\n        resolve( fhirutils._code_cache[lookup] )\n      }\n    } )\n  },\n  pathFieldExpression: (field) => {\n    let expression = field.substring( field.indexOf(':')+1 )\n    if ( expression.includes('-') || expression.includes('.') ) {\n      return '`'+expression+'`'\n    } else {\n      return expression\n    }\n  },\n  expand: (valueset) => {\n    const itemSort = (a,b) => {\n      return (a.display === b.display ? (a.code === b.code ? 0 : (a.code < b.code ? -1: 1)) : (a.display < b.display ? -1 : 1) )\n    }\n    const populateItemsFromCompose = ( valueset, items ) => {\n      if ( valueset.compose.include ) {\n        for( let include of valueset.compose.include ) {\n          if ( include.concept ) {\n            for ( let concept of include.concept ) {\n              concept.system = include.system\n              items.push( concept )\n            }\n          }\n        }\n      }\n    }\n    return new Promise( (resolve, reject) => {\n      let lastSlash = valueset.lastIndexOf('/')\n      let lastPipe = valueset.lastIndexOf('|')\n      let valueSetId = valueset.slice(lastSlash+1, (lastPipe !== -1 ? lastPipe : valueset.length ))\n      let items = []\n\n      axios.get(\"/fhir/ValueSet/\"+valueSetId+\"/$expand\").then(response=> {\n        let data = response.data\n        try {\n          if ( ( !data.expansion || data.expansion.total === 0 ) && data.compose.include ) {\n            populateItemsFromCompose( data, items )\n          } else {\n            items = data.expansion.contains\n          }\n          items.sort( itemSort )\n          resolve( items )\n        } catch(err) {\n          console.log(err)\n          reject( new Error( \"Invalid response from server.\" ) )\n        }\n      }).catch(() => {\n        axios.get(\"/fhir/ValueSet/\"+valueSetId).then(response=> {\n          let data = response.data\n          populateItemsFromCompose( data, items )\n          items.sort( itemSort )\n          resolve( items )\n        }).catch(err=>{\n          reject(err)\n        })\n      })\n    } )\n  }\n}\n\nexport default fhirutils\n"]}]}