{"remainingRequest":"/home/ally/gofr/facility-recon-gui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ally/gofr/facility-recon-gui/src/components/ihris/ihris-secondary.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/ally/gofr/facility-recon-gui/src/components/ihris/ihris-secondary.vue","mtime":1619771141106},{"path":"/home/ally/gofr/facility-recon-gui/node_modules/cache-loader/dist/cjs.js","mtime":1619257191457},{"path":"/home/ally/gofr/facility-recon-gui/node_modules/babel-loader/lib/index.js","mtime":1619257191453},{"path":"/home/ally/gofr/facility-recon-gui/node_modules/cache-loader/dist/cjs.js","mtime":1619257191457},{"path":"/home/ally/gofr/facility-recon-gui/node_modules/vue-loader/lib/index.js","mtime":1619257191305}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmNvbnN0IGlzT2JqZWN0ID0gKG9iaikgPT4gewogIHJldHVybiAoISFvYmopICYmIChvYmouY29uc3RydWN0b3IgPT09IE9iamVjdCkKfQoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJpaHJpcy1zZWNvbmRhcnkiLAogIHByb3BzOiBbInRpdGxlIiwgImZpZWxkIiwgInByb2ZpbGUiLCAic2xvdFByb3BzIiwgImxpbmstaWQiLCAibGluay1maWVsZCIsIAogICAgInNlYXJjaC1maWVsZCIsICJlZGl0IiwgImNvbHVtbnMiLCAiYWN0aW9ucyJdLAogIGRhdGE6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHsKICAgICAgc291cmNlOiB7IGRhdGE6IHt9LCBwYXRoOiB0aGlzLmZpZWxkIH0sCiAgICAgIGVtcHR5OiB0cnVlLAogICAgICBpdGVtczogW10sCiAgICAgIGxvYWRpbmc6IHRydWUsCiAgICAgIHRvcEFjdGlvbnM6IFtdCiAgICB9CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbigpIHsKICAgIHRoaXMuc2V0dXBEYXRhKCkKICB9LAogIHdhdGNoOiB7CiAgICAvKgogICAgc2xvdFByb3BzOiB7CiAgICAgIGhhbmRsZXIoKSB7CiAgICAgICAgdGhpcy5zZXR1cERhdGEoKQogICAgICB9LCAKICAgICAgZGVlcDogdHJ1ZQogICAgfQogICAgKi8KICB9LAogIG1ldGhvZHM6IHsKICAgIHNldHVwRGF0YTogZnVuY3Rpb24oKSB7CiAgICAgIC8qCiAgICAgIGlmICggdGhpcy5zbG90UHJvcHMgJiYgdGhpcy5zbG90UHJvcHMuc291cmNlICkgewogICAgICAgIHRoaXMuc291cmNlID0geyBwYXRoOiB0aGlzLmZpZWxkLCBkYXRhOiB7fSB9CiAgICAgICAgaWYgKCB0aGlzLnNsb3RQcm9wcy5zb3VyY2UuZnJvbUFycmF5ICkgewogICAgICAgICAgdGhpcy5zb3VyY2UuZGF0YSA9IHRoaXMuc2xvdFByb3BzLnNvdXJjZS5kYXRhCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc291cmNlLmRhdGEgPSB0aGlzLiRmaGlycGF0aC5ldmFsdWF0ZSggdGhpcy5zbG90UHJvcHMuc291cmNlLmRhdGEsIHRoaXMuZmllbGQgKQogICAgICAgIH0KICAgICAgICAvL2NvbnNvbGUubG9nKHRoaXMuc291cmNlKQogICAgICB9CiAgICAgICovCiAgICAgIGxldCB1cmwgPSAiL2ZoaXIvIiArIHRoaXMuZmllbGQKICAgICAgbGV0IHF1ZXJ5U3RyID0gW10KICAgICAgaWYgKCB0aGlzLnByb2ZpbGUgKSB7CiAgICAgICAgcXVlcnlTdHIucHVzaCggIl9wcm9maWxlPSIrdGhpcy5wcm9maWxlICkKICAgICAgfQogICAgICBpZiAoIHRoaXMuc2VhcmNoRmllbGQgKSB7CiAgICAgICAgcXVlcnlTdHIucHVzaCggdGhpcy5zZWFyY2hGaWVsZCsiPSIrdGhpcy5saW5rSWQgKQogICAgICB9IGVsc2UgewogICAgICAgIHF1ZXJ5U3RyLnB1c2goIHRoaXMubGlua0ZpZWxkLnN1YnN0cmluZyggdGhpcy5saW5rRmllbGQuaW5kZXhPZignLicpICsxICkgKyI9Iit0aGlzLmxpbmtJZCApCiAgICAgIH0KICAgICAgdXJsICs9ICI/IiArIHF1ZXJ5U3RyLmpvaW4oIiYiKQogICAgICB0aGlzLml0ZW1zID0gW10KICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZQogICAgICB0aGlzLmFkZEl0ZW1zKCB1cmwgKQogICAgfSwKICAgIGFkZEl0ZW1zOiBmdW5jdGlvbiAodXJsKSB7CiAgICAgIGZldGNoKCB1cmwgKS50aGVuKCByZXNwb25zZSA9PiB7CiAgICAgICAgaWYgKCByZXNwb25zZS5zdGF0dXMgPT09IDIwMCApIHsKICAgICAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKCBhc3luYyBkYXRhID0+IHsKICAgICAgICAgICAgaWYgKCBkYXRhLmVudHJ5ICYmIGRhdGEuZW50cnkubGVuZ3RoID4gMCApIHsKICAgICAgICAgICAgICBmb3IoIGxldCBlbnRyeSBvZiBkYXRhLmVudHJ5ICkgewogICAgICAgICAgICAgICAgbGV0IHJvdyA9IHsgaWQ6IGVudHJ5LnJlc291cmNlLmlkIH0KICAgICAgICAgICAgICAgIGZvciggbGV0IGhlYWRlciBvZiB0aGlzLmNvbHVtbnMgKSB7CiAgICAgICAgICAgICAgICAgIGlmICggaGVhZGVyLnZhbHVlID09PSAiX2FjdGlvbiIgKSBjb250aW51ZQogICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGxldCBjb250ZW50ID0gdGhpcy4kZmhpcnBhdGguZXZhbHVhdGUoIGVudHJ5LnJlc291cmNlLCBoZWFkZXIudmFsdWUgKQogICAgICAgICAgICAgICAgICAgIHJvd1toZWFkZXIudmFsdWVdID0gYXdhaXQgdGhpcy5wcm9jZXNzQ29udGVudCggY29udGVudCApCiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKCBlcnIgKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoICFyb3cuYWN0aW9ucyApIHJvdy5hY3Rpb25zID0gW10KICAgICAgICAgICAgICAgIGZvciggbGV0IGFjdGlvbiBvZiB0aGlzLmFjdGlvbnMgKSB7CiAgICAgICAgICAgICAgICAgIGlmICggYWN0aW9uLnJvdyApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIGFjdGlvbi5jb25kaXRpb24gKSB7CiAgICAgICAgICAgICAgICAgICAgICBsZXQgbWVldHMgPSB0aGlzLiRmaGlycGF0aC5ldmFsdWF0ZSggZW50cnkucmVzb3VyY2UsIGFjdGlvbi5jb25kaXRpb24gKQogICAgICAgICAgICAgICAgICAgICAgaWYgKCBtZWV0cy5ldmVyeSggbWVldCA9PiBtZWV0ICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvdy5hY3Rpb25zLnB1c2goIGFjdGlvbiApCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIHJvdy5hY3Rpb25zLnB1c2goIGFjdGlvbiApCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICggYWN0aW9uLmNvbmRpdGlvbiApIHsKICAgICAgICAgICAgICAgICAgICAgIGxldCBtZWV0cyA9IHRoaXMuJGZoaXJwYXRoLmV2YWx1YXRlKCBlbnRyeS5yZXNvdXJjZSwgYWN0aW9uLmNvbmRpdGlvbiApCiAgICAgICAgICAgICAgICAgICAgICBpZiAoIGFjdGlvbi5oYXNPd25Qcm9wZXJ0eSgibWVldHMiKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uLm1lZXRzID0gYWN0aW9uLm1lZXRzICYmIG1lZXRzLmV2ZXJ5KCBtZWV0ID0+IG1lZXQgKQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uLm1lZXRzID0gbWVldHMuZXZlcnkoIG1lZXQgPT4gbWVldCApCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbi5tZWV0cyA9IHRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMucHVzaCggcm93ICkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZm9yKCBsZXQgYWN0aW9uIG9mIHRoaXMuYWN0aW9ucyApIHsKICAgICAgICAgICAgICAgIGlmICggIWFjdGlvbi5yb3cgKSB7CiAgICAgICAgICAgICAgICAgIGFjdGlvbi5tZWV0cyA9IGFjdGlvbi5lbXB0eURpc3BsYXkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy50b3BBY3Rpb25zID0gdGhpcy5hY3Rpb25zLmZpbHRlciggYWN0aW9uID0+ICFhY3Rpb24ucm93ICYmIGFjdGlvbi5tZWV0cyApCgoKICAgICAgICAgICAgaWYgKCBkYXRhLmxpbmsgKSB7CiAgICAgICAgICAgICAgbGV0IG5leHQgPSBkYXRhLmxpbmsuZmluZCggbGluayA9PiBsaW5rLnJlbGF0aW9uID09PSAibmV4dCIgKQogICAgICAgICAgICAgIGlmICggbmV4dCApIHsKICAgICAgICAgICAgICAgIHRoaXMuYWRkSXRlbXMoIG5leHQudXJsICkKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgfSApLmNhdGNoKCBlcnIgPT4gewogICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpCiAgICAgICAgICB9ICkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2UKICAgICAgICAgIGNvbnNvbGUubG9nKCJVbmFibGUgdG8gZmV0Y2giLHVybCxyZXNwb25zZS5zdGF0dXMpCiAgICAgICAgfQogICAgICB9ICkuY2F0Y2goIGVyciA9PiB7CiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2UKICAgICAgICBjb25zb2xlLmxvZyhlcnIpCiAgICAgIH0gKQoKICAgIH0sCiAgICBwcm9jZXNzQ29udGVudDogYXN5bmMgZnVuY3Rpb24oIGNvbnRlbnQgKSB7CiAgICAgIGlmICggQXJyYXkuaXNBcnJheSggY29udGVudCApICkgewogICAgICAgIGxldCBvdXRwdXQgPSBhd2FpdCBQcm9taXNlLmFsbChjb250ZW50Lm1hcCggdGhpcy5wcm9jZXNzQ29udGVudCApKQogICAgICAgIHJldHVybiBvdXRwdXQuam9pbigiICIpCiAgICAgIH0gZWxzZSBpZiAoIGlzT2JqZWN0KCBjb250ZW50ICkgKSB7CiAgICAgICAgaWYgKCBjb250ZW50LmNvZGUgJiYgY29udGVudC5zeXN0ZW0gKSB7CiAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy4kZmhpcnV0aWxzLmNvZGVMb29rdXAoIGNvbnRlbnQuc3lzdGVtLCBjb250ZW50LmNvZGUgKQogICAgICAgIH0gZWxzZSBpZiAoIGNvbnRlbnQuZGlzcGxheSApIHsKICAgICAgICAgIHJldHVybiBjb250ZW50LmRpc3BsYXkKICAgICAgICB9IGVsc2UgaWYgKCBjb250ZW50LmNvZGUgKSB7CiAgICAgICAgICByZXR1cm4gY29udGVudC5jb2RlCiAgICAgICAgfSBlbHNlIGlmICggY29udGVudC5yZWZlcmVuY2UgKSB7CiAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy4kZmhpcnV0aWxzLnJlc291cmNlTG9va3VwKCBjb250ZW50LnJlZmVyZW5jZSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS5sb2coIlVuYWJsZSB0byBwcm9jZXNzIGNvbnRlbnQ6Iixjb250ZW50KQogICAgICAgICAgcmV0dXJuICJVbmtub3duIgogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gY29udGVudAogICAgICB9CiAgICB9LAogICAgc2V0dXBMaW5rKCBsaW5rLCBpdGVtICkgewogICAgICByZXR1cm4gbGluay5yZXBsYWNlKCAiSVRFTUlEIiwgaXRlbS5pZCApLnJlcGxhY2UoICJGSElSSUQiLCB0aGlzLmxpbmtJZCApCiAgICB9CiAgfQp9Cgo="},{"version":3,"sources":["ihris-secondary.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8CA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ihris-secondary.vue","sourceRoot":"src/components/ihris","sourcesContent":["<template>\n  <v-container class=\"my-3\" v-if=\"!edit\">\n    <v-data-table\n      :headers=\"columns\"\n      :items=\"items\"\n      item-key=\"id\"\n      :items-per-page=\"5\"\n      :loading=\"loading\"\n      class=\"elevation-1\"\n      dense\n    >\n      \n      <template v-slot:top>\n        <v-toolbar flat color=\"white\">\n          <v-toolbar-title>\n            {{ title }}\n          </v-toolbar-title>\n          <v-spacer></v-spacer>\n          <v-btn \n            v-for=\"action in topActions\" \n            :to=\"setupLink( action.link, {} )\" \n            :color=\"action.class\" \n            :key=\"action.text\"\n            small\n            >\n            {{ action.text }}\n          </v-btn>\n        </v-toolbar>\n      </template>\n      <template v-slot:item._action=\"{ item }\">\n        <v-btn \n          v-for=\"action in item.actions\" \n          :to=\"setupLink( action.link, item )\" \n          :color=\"action.class\" \n          :key=\"action.text\"\n          small\n          rounded\n          >\n          {{ action.text }}\n        </v-btn>\n      </template>\n    </v-data-table>\n  </v-container>\n</template>\n\n<script>\nconst isObject = (obj) => {\n  return (!!obj) && (obj.constructor === Object)\n}\n\nexport default {\n  name: \"ihris-secondary\",\n  props: [\"title\", \"field\", \"profile\", \"slotProps\", \"link-id\", \"link-field\", \n    \"search-field\", \"edit\", \"columns\", \"actions\"],\n  data: function() {\n    return {\n      source: { data: {}, path: this.field },\n      empty: true,\n      items: [],\n      loading: true,\n      topActions: []\n    }\n  },\n  mounted: function() {\n    this.setupData()\n  },\n  watch: {\n    /*\n    slotProps: {\n      handler() {\n        this.setupData()\n      }, \n      deep: true\n    }\n    */\n  },\n  methods: {\n    setupData: function() {\n      /*\n      if ( this.slotProps && this.slotProps.source ) {\n        this.source = { path: this.field, data: {} }\n        if ( this.slotProps.source.fromArray ) {\n          this.source.data = this.slotProps.source.data\n        } else {\n          this.source.data = this.$fhirpath.evaluate( this.slotProps.source.data, this.field )\n        }\n        //console.log(this.source)\n      }\n      */\n      let url = \"/fhir/\" + this.field\n      let queryStr = []\n      if ( this.profile ) {\n        queryStr.push( \"_profile=\"+this.profile )\n      }\n      if ( this.searchField ) {\n        queryStr.push( this.searchField+\"=\"+this.linkId )\n      } else {\n        queryStr.push( this.linkField.substring( this.linkField.indexOf('.') +1 ) +\"=\"+this.linkId )\n      }\n      url += \"?\" + queryStr.join(\"&\")\n      this.items = []\n      this.loading = true\n      this.addItems( url )\n    },\n    addItems: function (url) {\n      fetch( url ).then( response => {\n        if ( response.status === 200 ) {\n          response.json().then( async data => {\n            if ( data.entry && data.entry.length > 0 ) {\n              for( let entry of data.entry ) {\n                let row = { id: entry.resource.id }\n                for( let header of this.columns ) {\n                  if ( header.value === \"_action\" ) continue\n                  try {\n                    let content = this.$fhirpath.evaluate( entry.resource, header.value )\n                    row[header.value] = await this.processContent( content )\n                  } catch ( err ) {\n                    console.log(err)\n                  }\n                }\n                if ( !row.actions ) row.actions = []\n                for( let action of this.actions ) {\n                  if ( action.row ) {\n                    if ( action.condition ) {\n                      let meets = this.$fhirpath.evaluate( entry.resource, action.condition )\n                      if ( meets.every( meet => meet ) ) {\n                        row.actions.push( action )\n                      }\n                    } else {\n                      row.actions.push( action )\n                    }\n                  } else {\n                    if ( action.condition ) {\n                      let meets = this.$fhirpath.evaluate( entry.resource, action.condition )\n                      if ( action.hasOwnProperty(\"meets\") ) {\n                        action.meets = action.meets && meets.every( meet => meet )\n                      } else {\n                        action.meets = meets.every( meet => meet )\n                      }\n                    } else {\n                      action.meets = true\n                    }\n                  }\n                }\n                this.items.push( row )\n              }\n            } else {\n              for( let action of this.actions ) {\n                if ( !action.row ) {\n                  action.meets = action.emptyDisplay\n                }\n              }\n            }\n            this.topActions = this.actions.filter( action => !action.row && action.meets )\n\n\n            if ( data.link ) {\n              let next = data.link.find( link => link.relation === \"next\" )\n              if ( next ) {\n                this.addItems( next.url )\n              } else {\n                this.loading = false\n              }\n            } else {\n              this.loading = false\n            }\n          } ).catch( err => {\n            this.loading = false\n            console.log(err)\n          } )\n        } else {\n          this.loading = false\n          console.log(\"Unable to fetch\",url,response.status)\n        }\n      } ).catch( err => {\n        this.loading = false\n        console.log(err)\n      } )\n\n    },\n    processContent: async function( content ) {\n      if ( Array.isArray( content ) ) {\n        let output = await Promise.all(content.map( this.processContent ))\n        return output.join(\" \")\n      } else if ( isObject( content ) ) {\n        if ( content.code && content.system ) {\n          return await this.$fhirutils.codeLookup( content.system, content.code )\n        } else if ( content.display ) {\n          return content.display\n        } else if ( content.code ) {\n          return content.code\n        } else if ( content.reference ) {\n          return await this.$fhirutils.resourceLookup( content.reference)\n        } else {\n          console.log(\"Unable to process content:\",content)\n          return \"Unknown\"\n        }\n      } else {\n        return content\n      }\n    },\n    setupLink( link, item ) {\n      return link.replace( \"ITEMID\", item.id ).replace( \"FHIRID\", this.linkId )\n    }\n  }\n}\n\n</script>\n"]}]}