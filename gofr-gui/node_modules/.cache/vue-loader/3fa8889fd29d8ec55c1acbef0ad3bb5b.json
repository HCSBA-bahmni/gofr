{"remainingRequest":"/home/ally/gofr/gofr-gui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ally/gofr/gofr-gui/src/components/fhir/fhir-attachment.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/ally/gofr/gofr-gui/src/components/fhir/fhir-attachment.vue","mtime":1620113805478},{"path":"/home/ally/gofr/gofr-gui/node_modules/cache-loader/dist/cjs.js","mtime":1619257191457},{"path":"/home/ally/gofr/gofr-gui/node_modules/babel-loader/lib/index.js","mtime":1619257191453},{"path":"/home/ally/gofr/gofr-gui/node_modules/cache-loader/dist/cjs.js","mtime":1619257191457},{"path":"/home/ally/gofr/gofr-gui/node_modules/vue-loader/lib/index.js","mtime":1619257191305}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcycKaW1wb3J0IElocmlzRWxlbWVudCBmcm9tICIuLi9paHJpcy9paHJpcy1lbGVtZW50LnZ1ZSIKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiZmhpci1hdHRhY2htZW50IiwKICBwcm9wczogWyJmaWVsZCIsICJsYWJlbCIsICJtaW4iLCAibWF4IiwgImlkIiwgInBhdGgiLCAic2xvdFByb3BzIiwgInNsaWNlTmFtZSIsImJhc2UtbWluIiwiYmFzZS1tYXgiLCJlZGl0IiwicmVhZE9ubHlJZlNldCIsCiAgICAiY29uc3RyYWludHMiXSwKICBjb21wb25lbnRzOiB7CiAgICBJaHJpc0VsZW1lbnQKICB9LAogIGRhdGE6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHsKICAgICAgc291cmNlOiB7IHBhdGg6ICIiLCBkYXRhOiB7fSB9LAogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgdXBsb2FkOiB1bmRlZmluZWQsCiAgICAgIHZhbHVlOiB7IGNvbnRlbnRUeXBlOiAiIiwgZGF0YTogIiIsIHRpdGxlOiAiIiB9LAogICAgICBvcmlnVmFsdWU6IHsgY29udGVudFR5cGU6ICIiLCBkYXRhOiAiIiwgdGl0bGU6ICIiIH0sCiAgICAgIHFGaWVsZDogInZhbHVlQXR0YWNobWVudCIsCiAgICAgIGRpc2FibGVkOiBmYWxzZSwKICAgICAgb2JqVVJMOiAiIiwKICAgICAgZXJyb3JzOiBbXSwKICAgICAgbG9ja1dhdGNoOiBmYWxzZQogICAgfQogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24oKSB7CiAgICAvL2NvbnNvbGUubG9nKCJDUkVBVEUgQVRUQUNIIix0aGlzLmZpZWxkLHRoaXMuc2xvdFByb3BzKQogICAgdGhpcy5zZXR1cERhdGEoKQogIH0sCiAgd2F0Y2g6IHsKICAgIHNsb3RQcm9wczogewogICAgICBoYW5kbGVyKCkgewogICAgICAgIC8vY29uc29sZS5sb2coIldBVENIIEFUVEFDSCIsdGhpcy5maWVsZCx0aGlzLnBhdGgsdGhpcy5zbG90UHJvcHMpCiAgICAgICAgaWYgKCAhdGhpcy5sb2NrV2F0Y2ggKSB7CiAgICAgICAgICB0aGlzLnNldHVwRGF0YSgpCiAgICAgICAgfQogICAgICB9LAogICAgICBkZWVwOiB0cnVlCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBzZXR1cERhdGEoKSB7CiAgICAgIGlmICggdGhpcy5zbG90UHJvcHMgJiYgdGhpcy5zbG90UHJvcHMuc291cmNlICkgewogICAgICAgIHRoaXMuc291cmNlID0geyBwYXRoOiB0aGlzLnNsb3RQcm9wcy5zb3VyY2UucGF0aCsiLiIrdGhpcy5maWVsZCwgZGF0YToge30gfQogICAgICAgIGlmICggdGhpcy5zbG90UHJvcHMuc291cmNlLmZyb21BcnJheSApIHsKICAgICAgICAgIHRoaXMuc291cmNlLmRhdGEgPSB0aGlzLnNsb3RQcm9wcy5zb3VyY2UuZGF0YQogICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuc291cmNlLmRhdGEKICAgICAgICAgIHRoaXMub3JpZ1ZhbHVlID0gdGhpcy52YWx1ZQogICAgICAgICAgdGhpcy5sb2NrV2F0Y2ggPSB0cnVlCiAgICAgICAgICAvL2NvbnNvbGUubG9nKCJTRVQgdmFsdWUgdG8gIiwgdGhpcy5zb3VyY2UuZGF0YSwgdGhpcy5zbG90UHJvcHMuaW5wdXQpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxldCBleHByZXNzaW9uID0gdGhpcy4kZmhpcnV0aWxzLnBhdGhGaWVsZEV4cHJlc3Npb24oIHRoaXMuZmllbGQgKQogICAgICAgICAgdGhpcy5zb3VyY2UuZGF0YSA9IHRoaXMuJGZoaXJwYXRoLmV2YWx1YXRlKCB0aGlzLnNsb3RQcm9wcy5zb3VyY2UuZGF0YSwgZXhwcmVzc2lvbiApCiAgICAgICAgICAvL2NvbnNvbGUubG9nKCJTVFIgRkhJUlBBVEgiLCB0aGlzLnNsb3RQcm9wcy5zb3VyY2UuZGF0YSwgdGhpcy5maWVsZCkKICAgICAgICAgIGlmICggdGhpcy5zb3VyY2UuZGF0YS5sZW5ndGggPT0gMSApIHsKICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuc291cmNlLmRhdGFbMF0KICAgICAgICAgICAgdGhpcy5vcmlnVmFsdWUgPSB0aGlzLnZhbHVlCiAgICAgICAgICAgIHRoaXMubG9ja1dhdGNoID0gdHJ1ZQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnNldE9iamVjdFVSTCgpCiAgICAgIHRoaXMuZGlzYWJsZWQgPSB0aGlzLnJlYWRPbmx5SWZTZXQgJiYgKCEhdGhpcy52YWx1ZSkKICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLnNvdXJjZSkKICAgIH0sCiAgICBzZXRPYmplY3RVUkwoKSB7CiAgICAgIGlmICggdGhpcy5vYmpVUkwgKSB7CiAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCggdGhpcy5vYmpVUkwgKQogICAgICB9CiAgICAgIGlmICggdGhpcy52YWx1ZS5kYXRhICYmIHRoaXMudmFsdWUuY29udGVudFR5cGUgKSB7CiAgICAgICAgbGV0IGRhdGFVUkwgPSAiZGF0YToiK3RoaXMudmFsdWUuY29udGVudFR5cGUrIjtiYXNlNjQsIit0aGlzLnZhbHVlLmRhdGEKICAgICAgICBheGlvcyh7CiAgICAgICAgICBtZXRob2Q6ICdHRVQnLAogICAgICAgICAgdXJsOiBkYXRhVVJMLAogICAgICAgICAgcmVzcG9uc2VUeXBlOiAnYmxvYicKICAgICAgICB9KS50aGVuKCAoYmxvYikgPT4gewogICAgICAgICAgdGhpcy5vYmpVUkwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKCBibG9iLmRhdGEgKQogICAgICAgIH0pLmNhdGNoKCBlID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJGYWlsZWQgdG8gZ2V0IGRhdGEgZnJvbSBiYXNlNjQuIixlKQogICAgICAgIH0gKQogICAgICB9CiAgICB9LAogICAgZG9VcGxvYWQoKSB7CiAgICAgIHRoaXMuZXJyb3JzID0gW10KICAgICAgaWYgKCAhdGhpcy51cGxvYWQgKSB7CiAgICAgICAgdGhpcy51cGxvYWQgPSB1bmRlZmluZWQKICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5vcmlnVmFsdWUKICAgICAgICB0aGlzLm9ialVSTCA9ICIiCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZQogICAgICAgIHRoaXMudmFsdWUuY29udGVudFR5cGUgPSB0aGlzLnVwbG9hZC50eXBlCiAgICAgICAgdGhpcy52YWx1ZS50aXRsZSA9IHRoaXMudXBsb2FkLm5hbWUKICAgICAgICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKQogICAgICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlciggdGhpcy51cGxvYWQgKQogICAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICBsZXQgZGF0YSA9IEJ1ZmZlci5mcm9tKCByZWFkZXIucmVzdWx0ICkKICAgICAgICAgIHRoaXMudmFsdWUuZGF0YSA9IGRhdGEudG9TdHJpbmcoJ2Jhc2U2NCcpCiAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZQogICAgICAgICAgdGhpcy5vYmpVUkwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKCB0aGlzLnVwbG9hZCApCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgaXNJbWFnZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnZhbHVlLmNvbnRlbnRUeXBlICYmIHRoaXMudmFsdWUuY29udGVudFR5cGUuc3RhcnRzV2l0aCgiaW1hZ2UvIikKICAgIH0sCiAgICBpbmRleDogZnVuY3Rpb24oKSB7CiAgICAgIGlmICggdGhpcy5zbG90UHJvcHMgJiYgdGhpcy5zbG90UHJvcHMuaW5wdXQgKSByZXR1cm4gdGhpcy5zbG90UHJvcHMuaW5wdXQuaW5kZXgKICAgICAgZWxzZSByZXR1cm4gdW5kZWZpbmVkCiAgICB9LAogICAgZGlzcGxheTogZnVuY3Rpb24oKSB7CiAgICAgIGlmICggdGhpcy5zbG90UHJvcHMgJiYgdGhpcy5zbG90UHJvcHMuaW5wdXQpIHJldHVybiB0aGlzLnNsb3RQcm9wcy5pbnB1dC5sYWJlbAogICAgICBlbHNlIHJldHVybiB0aGlzLmxhYmVsCiAgICB9LAogICAgcmVxdWlyZWQ6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gKHRoaXMuaW5kZXggfHwgMCkgPCB0aGlzLm1pbgogICAgfSwKICAgIHJ1bGVzOiBmdW5jdGlvbigpIHsKICAgICAgaWYgKCB0aGlzLnJlcXVpcmVkICkgewogICAgICAgIHJldHVybiBbIHYgPT4gISF2IHx8IHRoaXMuZGlzcGxheSsiIGlzIHJlcXVpcmVkIiBdCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIFtdCiAgICAgIH0KICAgIH0KICB9Cn0K"},{"version":3,"sources":["fhir-attachment.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"fhir-attachment.vue","sourceRoot":"src/components/fhir","sourcesContent":["<template>\n  <ihris-element :edit=\"edit\" :loading=\"false\">\n    <template #form>\n      <v-file-input\n        :disabled=\"disabled\"\n        :label=\"display\"\n        :loading=\"loading\"\n        v-model=\"upload\"\n        outlined\n        hide-details=\"auto\"\n        :rules=\"rules\"\n        dense\n        @change='doUpload'\n        :error-messages=\"errors\"\n      >\n        <template #label>{{display}} <span v-if=\"required\" class=\"red--text font-weight-bold\">*</span></template>\n        <template #append-outer>\n          <v-menu\n            v-if=\"objURL\"\n            offset-y\n            left\n            eager\n          >\n            <template v-slot:activator=\"{on, attrs}\">\n              <v-btn\n                color=\"accent\"\n                dark\n                fab\n                x-small\n                v-bind=\"attrs\"\n                v-on=\"on\"><v-icon>mdi-file-eye</v-icon></v-btn>\n            </template>\n            <v-list>\n              <v-list-item>\n                <v-img v-if=\"isImage\" :src=\"objURL\"/>\n                <a v-else :download=\"value.title\" :href=\"objURL\">{{value.title}}</a>\n              </v-list-item>\n            </v-list>\n          </v-menu>\n        </template>\n      </v-file-input>\n    </template>\n    <template #header>\n      {{display}}\n    </template>\n    <template #value>\n      <v-menu\n        v-if=\"isImage\"\n        absolute\n        eager\n        >\n        <template v-slot:activator=\"{on, attrs}\">\n          <v-img :src=\"objURL\" contain :max-height=\"150\" position=\"left\" v-bind=\"attrs\" v-on=\"on\" />\n        </template>\n        <v-list min-width=\"0\">\n          <v-list-item>\n            <v-img :src=\"objURL\" />\n          </v-list-item>\n        </v-list>\n      </v-menu>\n      <a v-else :href=\"objURL\">{{value.title}}</a>\n    </template>\n  </ihris-element>\n</template>\n\n<script>\nimport axios from 'axios'\nimport IhrisElement from \"../ihris/ihris-element.vue\"\n\nexport default {\n  name: \"fhir-attachment\",\n  props: [\"field\", \"label\", \"min\", \"max\", \"id\", \"path\", \"slotProps\", \"sliceName\",\"base-min\",\"base-max\",\"edit\",\"readOnlyIfSet\",\n    \"constraints\"],\n  components: {\n    IhrisElement\n  },\n  data: function() {\n    return {\n      source: { path: \"\", data: {} },\n      loading: false,\n      upload: undefined,\n      value: { contentType: \"\", data: \"\", title: \"\" },\n      origValue: { contentType: \"\", data: \"\", title: \"\" },\n      qField: \"valueAttachment\",\n      disabled: false,\n      objURL: \"\",\n      errors: [],\n      lockWatch: false\n    }\n  },\n  created: function() {\n    //console.log(\"CREATE ATTACH\",this.field,this.slotProps)\n    this.setupData()\n  },\n  watch: {\n    slotProps: {\n      handler() {\n        //console.log(\"WATCH ATTACH\",this.field,this.path,this.slotProps)\n        if ( !this.lockWatch ) {\n          this.setupData()\n        }\n      },\n      deep: true\n    }\n  },\n  methods: {\n    setupData() {\n      if ( this.slotProps && this.slotProps.source ) {\n        this.source = { path: this.slotProps.source.path+\".\"+this.field, data: {} }\n        if ( this.slotProps.source.fromArray ) {\n          this.source.data = this.slotProps.source.data\n          this.value = this.source.data\n          this.origValue = this.value\n          this.lockWatch = true\n          //console.log(\"SET value to \", this.source.data, this.slotProps.input)\n        } else {\n          let expression = this.$fhirutils.pathFieldExpression( this.field )\n          this.source.data = this.$fhirpath.evaluate( this.slotProps.source.data, expression )\n          //console.log(\"STR FHIRPATH\", this.slotProps.source.data, this.field)\n          if ( this.source.data.length == 1 ) {\n            this.value = this.source.data[0]\n            this.origValue = this.value\n            this.lockWatch = true\n          }\n        }\n      }\n      this.setObjectURL()\n      this.disabled = this.readOnlyIfSet && (!!this.value)\n      //console.log(this.source)\n    },\n    setObjectURL() {\n      if ( this.objURL ) {\n        URL.revokeObjectURL( this.objURL )\n      }\n      if ( this.value.data && this.value.contentType ) {\n        let dataURL = \"data:\"+this.value.contentType+\";base64,\"+this.value.data\n        axios({\n          method: 'GET',\n          url: dataURL,\n          responseType: 'blob'\n        }).then( (blob) => {\n          this.objURL = URL.createObjectURL( blob.data )\n        }).catch( e => {\n          console.log(\"Failed to get data from base64.\",e)\n        } )\n      }\n    },\n    doUpload() {\n      this.errors = []\n      if ( !this.upload ) {\n        this.upload = undefined\n        this.value = this.origValue\n        this.objURL = \"\"\n      } else {\n        this.loading = true\n        this.value.contentType = this.upload.type\n        this.value.title = this.upload.name\n        let reader = new FileReader()\n        reader.readAsArrayBuffer( this.upload )\n        reader.onload = () => {\n          let data = Buffer.from( reader.result )\n          this.value.data = data.toString('base64')\n          this.loading = false\n          this.objURL = URL.createObjectURL( this.upload )\n        }\n      }\n    }\n  },\n  computed: {\n    isImage: function() {\n      return this.value.contentType && this.value.contentType.startsWith(\"image/\")\n    },\n    index: function() {\n      if ( this.slotProps && this.slotProps.input ) return this.slotProps.input.index\n      else return undefined\n    },\n    display: function() {\n      if ( this.slotProps && this.slotProps.input) return this.slotProps.input.label\n      else return this.label\n    },\n    required: function() {\n      return (this.index || 0) < this.min\n    },\n    rules: function() {\n      if ( this.required ) {\n        return [ v => !!v || this.display+\" is required\" ]\n      } else {\n        return []\n      }\n    }\n  }\n}\n</script>\n"]}]}