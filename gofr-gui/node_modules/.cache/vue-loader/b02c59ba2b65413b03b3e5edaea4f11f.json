{"remainingRequest":"/home/ally/gofr/gofr-gui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ally/gofr/gofr-gui/src/components/ihris/ihris-secondary.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/ally/gofr/gofr-gui/src/components/ihris/ihris-secondary.vue","mtime":1620114035917},{"path":"/home/ally/gofr/gofr-gui/node_modules/cache-loader/dist/cjs.js","mtime":1619257191457},{"path":"/home/ally/gofr/gofr-gui/node_modules/babel-loader/lib/index.js","mtime":1619257191453},{"path":"/home/ally/gofr/gofr-gui/node_modules/cache-loader/dist/cjs.js","mtime":1619257191457},{"path":"/home/ally/gofr/gofr-gui/node_modules/vue-loader/lib/index.js","mtime":1619257191305}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcycKY29uc3QgaXNPYmplY3QgPSAob2JqKSA9PiB7CiAgcmV0dXJuICghIW9iaikgJiYgKG9iai5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KQp9CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogImlocmlzLXNlY29uZGFyeSIsCiAgcHJvcHM6IFsidGl0bGUiLCAiZmllbGQiLCAicHJvZmlsZSIsICJzbG90UHJvcHMiLCAibGluay1pZCIsICJsaW5rLWZpZWxkIiwKICAgICJzZWFyY2gtZmllbGQiLCAiZWRpdCIsICJjb2x1bW5zIiwgImFjdGlvbnMiXSwKICBkYXRhOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB7CiAgICAgIHNvdXJjZTogeyBkYXRhOiB7fSwgcGF0aDogdGhpcy5maWVsZCB9LAogICAgICBlbXB0eTogdHJ1ZSwKICAgICAgaXRlbXM6IFtdLAogICAgICBsb2FkaW5nOiB0cnVlLAogICAgICB0b3BBY3Rpb25zOiBbXQogICAgfQogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24oKSB7CiAgICB0aGlzLnNldHVwRGF0YSgpCiAgfSwKICB3YXRjaDogewogICAgLyoKICAgIHNsb3RQcm9wczogewogICAgICBoYW5kbGVyKCkgewogICAgICAgIHRoaXMuc2V0dXBEYXRhKCkKICAgICAgfSwKICAgICAgZGVlcDogdHJ1ZQogICAgfQogICAgKi8KICB9LAogIG1ldGhvZHM6IHsKICAgIHNldHVwRGF0YTogZnVuY3Rpb24oKSB7CiAgICAgIC8qCiAgICAgIGlmICggdGhpcy5zbG90UHJvcHMgJiYgdGhpcy5zbG90UHJvcHMuc291cmNlICkgewogICAgICAgIHRoaXMuc291cmNlID0geyBwYXRoOiB0aGlzLmZpZWxkLCBkYXRhOiB7fSB9CiAgICAgICAgaWYgKCB0aGlzLnNsb3RQcm9wcy5zb3VyY2UuZnJvbUFycmF5ICkgewogICAgICAgICAgdGhpcy5zb3VyY2UuZGF0YSA9IHRoaXMuc2xvdFByb3BzLnNvdXJjZS5kYXRhCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc291cmNlLmRhdGEgPSB0aGlzLiRmaGlycGF0aC5ldmFsdWF0ZSggdGhpcy5zbG90UHJvcHMuc291cmNlLmRhdGEsIHRoaXMuZmllbGQgKQogICAgICAgIH0KICAgICAgICAvL2NvbnNvbGUubG9nKHRoaXMuc291cmNlKQogICAgICB9CiAgICAgICovCiAgICAgIGxldCB1cmwgPSAiL2ZoaXIvIiArIHRoaXMuZmllbGQKICAgICAgbGV0IHF1ZXJ5U3RyID0gW10KICAgICAgaWYgKCB0aGlzLnByb2ZpbGUgKSB7CiAgICAgICAgcXVlcnlTdHIucHVzaCggIl9wcm9maWxlPSIrdGhpcy5wcm9maWxlICkKICAgICAgfQogICAgICBpZiAoIHRoaXMuc2VhcmNoRmllbGQgKSB7CiAgICAgICAgcXVlcnlTdHIucHVzaCggdGhpcy5zZWFyY2hGaWVsZCsiPSIrdGhpcy5saW5rSWQgKQogICAgICB9IGVsc2UgewogICAgICAgIHF1ZXJ5U3RyLnB1c2goIHRoaXMubGlua0ZpZWxkLnN1YnN0cmluZyggdGhpcy5saW5rRmllbGQuaW5kZXhPZignLicpICsxICkgKyI9Iit0aGlzLmxpbmtJZCApCiAgICAgIH0KICAgICAgdXJsICs9ICI/IiArIHF1ZXJ5U3RyLmpvaW4oIiYiKQogICAgICB0aGlzLml0ZW1zID0gW10KICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZQogICAgICB0aGlzLmFkZEl0ZW1zKCB1cmwgKQogICAgfSwKICAgIGFkZEl0ZW1zOiBmdW5jdGlvbiAodXJsKSB7CiAgICAgIGF4aW9zLmdldCggdXJsICkudGhlbiggYXN5bmMgKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgbGV0IGRhdGEgPSByZXNwb25zZS5kYXRhCiAgICAgICAgaWYgKCBkYXRhLmVudHJ5ICYmIGRhdGEuZW50cnkubGVuZ3RoID4gMCApIHsKICAgICAgICAgIGZvciggbGV0IGVudHJ5IG9mIGRhdGEuZW50cnkgKSB7CiAgICAgICAgICAgIGxldCByb3cgPSB7IGlkOiBlbnRyeS5yZXNvdXJjZS5pZCB9CiAgICAgICAgICAgIGZvciggbGV0IGhlYWRlciBvZiB0aGlzLmNvbHVtbnMgKSB7CiAgICAgICAgICAgICAgaWYgKCBoZWFkZXIudmFsdWUgPT09ICJfYWN0aW9uIiApIGNvbnRpbnVlCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxldCBjb250ZW50ID0gdGhpcy4kZmhpcnBhdGguZXZhbHVhdGUoIGVudHJ5LnJlc291cmNlLCBoZWFkZXIudmFsdWUgKQogICAgICAgICAgICAgICAgcm93W2hlYWRlci52YWx1ZV0gPSBhd2FpdCB0aGlzLnByb2Nlc3NDb250ZW50KCBjb250ZW50ICkKICAgICAgICAgICAgICB9IGNhdGNoICggZXJyICkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoICFyb3cuYWN0aW9ucyApIHJvdy5hY3Rpb25zID0gW10KICAgICAgICAgICAgZm9yKCBsZXQgYWN0aW9uIG9mIHRoaXMuYWN0aW9ucyApIHsKICAgICAgICAgICAgICBpZiAoIGFjdGlvbi5yb3cgKSB7CiAgICAgICAgICAgICAgICBpZiAoIGFjdGlvbi5jb25kaXRpb24gKSB7CiAgICAgICAgICAgICAgICAgIGxldCBtZWV0cyA9IHRoaXMuJGZoaXJwYXRoLmV2YWx1YXRlKCBlbnRyeS5yZXNvdXJjZSwgYWN0aW9uLmNvbmRpdGlvbiApCiAgICAgICAgICAgICAgICAgIGlmICggbWVldHMuZXZlcnkoIG1lZXQgPT4gbWVldCApICkgewogICAgICAgICAgICAgICAgICAgIHJvdy5hY3Rpb25zLnB1c2goIGFjdGlvbiApCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHJvdy5hY3Rpb25zLnB1c2goIGFjdGlvbiApCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICggYWN0aW9uLmNvbmRpdGlvbiApIHsKICAgICAgICAgICAgICAgICAgbGV0IG1lZXRzID0gdGhpcy4kZmhpcnBhdGguZXZhbHVhdGUoIGVudHJ5LnJlc291cmNlLCBhY3Rpb24uY29uZGl0aW9uICkKICAgICAgICAgICAgICAgICAgaWYgKCBhY3Rpb24uaGFzT3duUHJvcGVydHkoIm1lZXRzIikgKSB7CiAgICAgICAgICAgICAgICAgICAgYWN0aW9uLm1lZXRzID0gYWN0aW9uLm1lZXRzICYmIG1lZXRzLmV2ZXJ5KCBtZWV0ID0+IG1lZXQgKQogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGFjdGlvbi5tZWV0cyA9IG1lZXRzLmV2ZXJ5KCBtZWV0ID0+IG1lZXQgKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBhY3Rpb24ubWVldHMgPSB0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuaXRlbXMucHVzaCggcm93ICkKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgZm9yKCBsZXQgYWN0aW9uIG9mIHRoaXMuYWN0aW9ucyApIHsKICAgICAgICAgICAgaWYgKCAhYWN0aW9uLnJvdyApIHsKICAgICAgICAgICAgICBhY3Rpb24ubWVldHMgPSBhY3Rpb24uZW1wdHlEaXNwbGF5CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy50b3BBY3Rpb25zID0gdGhpcy5hY3Rpb25zLmZpbHRlciggYWN0aW9uID0+ICFhY3Rpb24ucm93ICYmIGFjdGlvbi5tZWV0cyApCgoKICAgICAgICBpZiAoIGRhdGEubGluayApIHsKICAgICAgICAgIGxldCBuZXh0ID0gZGF0YS5saW5rLmZpbmQoIGxpbmsgPT4gbGluay5yZWxhdGlvbiA9PT0gIm5leHQiICkKICAgICAgICAgIGlmICggbmV4dCApIHsKICAgICAgICAgICAgdGhpcy5hZGRJdGVtcyggbmV4dC51cmwgKQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2UKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2UKICAgICAgICB9CiAgICAgIH0gKS5jYXRjaCggZXJyID0+IHsKICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZQogICAgICAgIGNvbnNvbGUubG9nKGVycikKICAgICAgfSApCgogICAgfSwKICAgIHByb2Nlc3NDb250ZW50OiBhc3luYyBmdW5jdGlvbiggY29udGVudCApIHsKICAgICAgaWYgKCBBcnJheS5pc0FycmF5KCBjb250ZW50ICkgKSB7CiAgICAgICAgbGV0IG91dHB1dCA9IGF3YWl0IFByb21pc2UuYWxsKGNvbnRlbnQubWFwKCB0aGlzLnByb2Nlc3NDb250ZW50ICkpCiAgICAgICAgcmV0dXJuIG91dHB1dC5qb2luKCIgIikKICAgICAgfSBlbHNlIGlmICggaXNPYmplY3QoIGNvbnRlbnQgKSApIHsKICAgICAgICBpZiAoIGNvbnRlbnQuY29kZSAmJiBjb250ZW50LnN5c3RlbSApIHsKICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLiRmaGlydXRpbHMuY29kZUxvb2t1cCggY29udGVudC5zeXN0ZW0sIGNvbnRlbnQuY29kZSApCiAgICAgICAgfSBlbHNlIGlmICggY29udGVudC5kaXNwbGF5ICkgewogICAgICAgICAgcmV0dXJuIGNvbnRlbnQuZGlzcGxheQogICAgICAgIH0gZWxzZSBpZiAoIGNvbnRlbnQuY29kZSApIHsKICAgICAgICAgIHJldHVybiBjb250ZW50LmNvZGUKICAgICAgICB9IGVsc2UgaWYgKCBjb250ZW50LnJlZmVyZW5jZSApIHsKICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLiRmaGlydXRpbHMucmVzb3VyY2VMb29rdXAoIGNvbnRlbnQucmVmZXJlbmNlKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiVW5hYmxlIHRvIHByb2Nlc3MgY29udGVudDoiLGNvbnRlbnQpCiAgICAgICAgICByZXR1cm4gIlVua25vd24iCiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBjb250ZW50CiAgICAgIH0KICAgIH0sCiAgICBzZXR1cExpbmsoIGxpbmssIGl0ZW0gKSB7CiAgICAgIHJldHVybiBsaW5rLnJlcGxhY2UoICJJVEVNSUQiLCBpdGVtLmlkICkucmVwbGFjZSggIkZISVJJRCIsIHRoaXMubGlua0lkICkKICAgIH0KICB9Cn0KCg=="},{"version":3,"sources":["ihris-secondary.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8CA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ihris-secondary.vue","sourceRoot":"src/components/ihris","sourcesContent":["<template>\n  <v-container class=\"my-3\" v-if=\"!edit\">\n    <v-data-table\n      :headers=\"columns\"\n      :items=\"items\"\n      item-key=\"id\"\n      :items-per-page=\"5\"\n      :loading=\"loading\"\n      class=\"elevation-1\"\n      dense\n    >\n\n      <template v-slot:top>\n        <v-toolbar flat color=\"white\">\n          <v-toolbar-title>\n            {{ title }}\n          </v-toolbar-title>\n          <v-spacer></v-spacer>\n          <v-btn\n            v-for=\"action in topActions\"\n            :to=\"setupLink( action.link, {} )\"\n            :color=\"action.class\"\n            :key=\"action.text\"\n            small\n            >\n            {{ action.text }}\n          </v-btn>\n        </v-toolbar>\n      </template>\n      <template v-slot:item._action=\"{ item }\">\n        <v-btn\n          v-for=\"action in item.actions\"\n          :to=\"setupLink( action.link, item )\"\n          :color=\"action.class\"\n          :key=\"action.text\"\n          small\n          rounded\n          >\n          {{ action.text }}\n        </v-btn>\n      </template>\n    </v-data-table>\n  </v-container>\n</template>\n\n<script>\nimport axios from 'axios'\nconst isObject = (obj) => {\n  return (!!obj) && (obj.constructor === Object)\n}\n\nexport default {\n  name: \"ihris-secondary\",\n  props: [\"title\", \"field\", \"profile\", \"slotProps\", \"link-id\", \"link-field\",\n    \"search-field\", \"edit\", \"columns\", \"actions\"],\n  data: function() {\n    return {\n      source: { data: {}, path: this.field },\n      empty: true,\n      items: [],\n      loading: true,\n      topActions: []\n    }\n  },\n  mounted: function() {\n    this.setupData()\n  },\n  watch: {\n    /*\n    slotProps: {\n      handler() {\n        this.setupData()\n      },\n      deep: true\n    }\n    */\n  },\n  methods: {\n    setupData: function() {\n      /*\n      if ( this.slotProps && this.slotProps.source ) {\n        this.source = { path: this.field, data: {} }\n        if ( this.slotProps.source.fromArray ) {\n          this.source.data = this.slotProps.source.data\n        } else {\n          this.source.data = this.$fhirpath.evaluate( this.slotProps.source.data, this.field )\n        }\n        //console.log(this.source)\n      }\n      */\n      let url = \"/fhir/\" + this.field\n      let queryStr = []\n      if ( this.profile ) {\n        queryStr.push( \"_profile=\"+this.profile )\n      }\n      if ( this.searchField ) {\n        queryStr.push( this.searchField+\"=\"+this.linkId )\n      } else {\n        queryStr.push( this.linkField.substring( this.linkField.indexOf('.') +1 ) +\"=\"+this.linkId )\n      }\n      url += \"?\" + queryStr.join(\"&\")\n      this.items = []\n      this.loading = true\n      this.addItems( url )\n    },\n    addItems: function (url) {\n      axios.get( url ).then( async (response) => {\n        let data = response.data\n        if ( data.entry && data.entry.length > 0 ) {\n          for( let entry of data.entry ) {\n            let row = { id: entry.resource.id }\n            for( let header of this.columns ) {\n              if ( header.value === \"_action\" ) continue\n              try {\n                let content = this.$fhirpath.evaluate( entry.resource, header.value )\n                row[header.value] = await this.processContent( content )\n              } catch ( err ) {\n                console.log(err)\n              }\n            }\n            if ( !row.actions ) row.actions = []\n            for( let action of this.actions ) {\n              if ( action.row ) {\n                if ( action.condition ) {\n                  let meets = this.$fhirpath.evaluate( entry.resource, action.condition )\n                  if ( meets.every( meet => meet ) ) {\n                    row.actions.push( action )\n                  }\n                } else {\n                  row.actions.push( action )\n                }\n              } else {\n                if ( action.condition ) {\n                  let meets = this.$fhirpath.evaluate( entry.resource, action.condition )\n                  if ( action.hasOwnProperty(\"meets\") ) {\n                    action.meets = action.meets && meets.every( meet => meet )\n                  } else {\n                    action.meets = meets.every( meet => meet )\n                  }\n                } else {\n                  action.meets = true\n                }\n              }\n            }\n            this.items.push( row )\n          }\n        } else {\n          for( let action of this.actions ) {\n            if ( !action.row ) {\n              action.meets = action.emptyDisplay\n            }\n          }\n        }\n        this.topActions = this.actions.filter( action => !action.row && action.meets )\n\n\n        if ( data.link ) {\n          let next = data.link.find( link => link.relation === \"next\" )\n          if ( next ) {\n            this.addItems( next.url )\n          } else {\n            this.loading = false\n          }\n        } else {\n          this.loading = false\n        }\n      } ).catch( err => {\n        this.loading = false\n        console.log(err)\n      } )\n\n    },\n    processContent: async function( content ) {\n      if ( Array.isArray( content ) ) {\n        let output = await Promise.all(content.map( this.processContent ))\n        return output.join(\" \")\n      } else if ( isObject( content ) ) {\n        if ( content.code && content.system ) {\n          return await this.$fhirutils.codeLookup( content.system, content.code )\n        } else if ( content.display ) {\n          return content.display\n        } else if ( content.code ) {\n          return content.code\n        } else if ( content.reference ) {\n          return await this.$fhirutils.resourceLookup( content.reference)\n        } else {\n          console.log(\"Unable to process content:\",content)\n          return \"Unknown\"\n        }\n      } else {\n        return content\n      }\n    },\n    setupLink( link, item ) {\n      return link.replace( \"ITEMID\", item.id ).replace( \"FHIRID\", this.linkId )\n    }\n  }\n}\n\n</script>\n"]}]}